<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fashion - FBC Creators</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
        }
        .font-serif, .font-serif * {
            font-family: 'Noto Serif KR', Georgia, serif !important;
        }

        /* Skeleton Loading Animation */
        @keyframes shimmer {
            0% { background-position: -468px 0; }
            100% { background-position: 468px 0; }
        }

        .skeleton {
            animation: shimmer 1.2s ease-in-out infinite;
            background: linear-gradient(to right, #f0f0f0 8%, #e0e0e0 18%, #f0f0f0 33%);
            background-size: 800px 104px;
        }

        .image-container {
            position: relative;
            overflow: hidden;
        }

        .image-container img {
            opacity: 0;
            transition: opacity 0.3s ease-in-out;
        }

        .image-container img.loaded {
            opacity: 1;
        }

        .fade-in {
            animation: fadeIn 0.6s ease-in;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        html {
            scroll-behavior: smooth;
        }
    </style>
</head>
<body class="bg-white text-gray-900">

<!-- Header -->
<header class="bg-white border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-3 items-center py-3 border-b">
            <div class="flex items-center space-x-4 text-xs">
                <button id="lang-toggle" class="px-3 py-1 border border-gray-300 hover:bg-gray-100 transition">
                    <span id="lang-text">English</span>
                </button>
            </div>
            <div class="justify-self-center">
                <a href="../index.html" class="hover:opacity-80 transition">
                    <h1 class="text-3xl font-serif font-bold tracking-wider">FBC</h1>
                </a>
            </div>
            <div class="justify-self-end flex items-center space-x-4 text-xs">
                <a href="#newsletter-section" class="hover:text-gray-600">SUBSCRIBE</a>
            </div>
        </div>
        <nav class="py-4">
            <ul class="flex items-center justify-center space-x-6 md:space-x-8 text-sm font-medium">
                <li><a href="../fashion/index.html" class="border-b-2 border-black pb-1">FASHION</a></li>
                <li><a href="../beauty/index.html" class="hover:text-gray-600 transition">BEAUTY</a></li>
                <li><a href="../life/index.html" class="hover:text-gray-600 transition">LIFE</a></li>
                <li><a href="../districts/index.html" class="hover:text-gray-600 transition">DISTRICTS</a></li>
            </ul>
        </nav>
    </div>
</header>

<!-- Main Content -->
<main class="max-w-7xl mx-auto px-4 py-12">

    <!-- Page Title -->
    <div class="mb-8">
        <h2 class="text-4xl font-serif font-bold mb-2">Fashion</h2>
        <p class="text-gray-600">Explore the latest K-fashion trends and styles</p>
    </div>

    <!-- Filter Tabs -->
    <div class="mb-12">
        <div class="flex flex-wrap gap-3 mb-6">
            <button class="px-4 py-2 text-xs font-semibold border rounded-full transition-all bg-black text-white border-black" data-filter="all" data-type="category">All</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Fashion Trend" data-type="category">Fashion Trend</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Fashion Item" data-type="category">Fashion Item</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Street Fashion" data-type="category">Street Fashion</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Shopping Guide" data-type="category">Shopping Guide</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Fashion Week" data-type="category">Fashion Week</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Traditional Fashion" data-type="category">Traditional Fashion</button>
            <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Fashion News" data-type="category">Fashion News</button>
        </div>
        <div class="border-t pt-4">
            <p class="text-sm text-gray-500 mb-2">Filter by Cultural Badge:</p>
            <div class="flex flex-wrap gap-3">
                <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="all" data-type="cultural">All</button>
                <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Industrial Chic" data-type="cultural">Industrial Chic</button>
                <button class="px-4 py-2 text-xs font-semibold border border-gray-300 rounded-full hover:border-black hover:bg-gray-50 transition-all bg-white" data-filter="Cultural Translation" data-type="cultural">Cultural Translation</button>
            </div>
        </div>
    </div>

    <!-- Hero Featured Article -->
    <section class="mb-16">
        <div id="hero-article"></div>
    </section>

    <!-- Featured Articles Grid -->
    <section class="mb-16">
        <div id="featured-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- Latest Stories -->
    <section class="mb-16 hidden" id="latest-section">
        <h3 class="text-2xl font-serif font-bold mb-6">Latest Stories</h3>
        <div id="latest-articles" class="grid grid-cols-1 md:grid-cols-3 lg:grid-cols-4 gap-6"></div>
    </section>

    <!-- Load More Button -->
    <div class="text-center mb-12 hidden" id="load-more-container">
        <button id="load-more" class="px-8 py-3 bg-black text-white font-medium hover:bg-gray-800 transition">
            <span id="load-more-text">Load More</span>
        </button>
    </div>

</main>

<!-- Footer -->
<footer class="bg-black text-white py-12">
    <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
            <div>
                <h3 class="font-serif text-2xl font-bold mb-4">FBC</h3>
                <p class="text-sm text-gray-400">Fashion, Beauty, Culture<br>with Cultural Translation</p>
            </div>
            <div>
                <h4 class="font-bold mb-3 text-sm">CATEGORIES</h4>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="../fashion/index.html" class="hover:text-white">Fashion</a></li>
                    <li><a href="../beauty/index.html" class="hover:text-white">Beauty</a></li>
                    <li><a href="../life/index.html" class="hover:text-white">Life & Culture</a></li>
                    <li><a href="../districts/index.html" class="hover:text-white">Districts</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold mb-3 text-sm">ABOUT</h4>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="../about/index.html" class="hover:text-white">About FBC</a></li>
                </ul>
            </div>
            <div id="newsletter-section">
                <h4 class="font-bold mb-3 text-sm">NEWSLETTER</h4>
                <p class="text-sm text-gray-400 mb-3">Get weekly K-fashion insights</p>
                <div class="flex">
                    <input type="email" id="newsletter-email" placeholder="Your email" class="px-3 py-2 bg-gray-800 text-sm flex-1 focus:outline-none">
                    <button id="newsletter-submit" class="px-4 py-2 bg-white text-black text-sm font-medium">→</button>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-800 pt-6 text-center text-xs text-gray-500">
            © 2025 FBC Creators. All rights reserved.
        </div>
    </div>
</footer>
<script type="module">
    // ============================================
    // Supabase Configuration
    // ============================================
    const SUPABASE_URL = 'https://ipcibnhhegkhdwyxeqjs.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImlwY2libmhoZWdraGR3eXhlcWpzIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MzMyNzYsImV4cCI6MjA3NjMwOTI3Nn0.LKjw1dqgjs39shvGpxcfFPutA7p1yR9eOb4zhomSBS8';

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ============================================
    // State Management
    // ============================================
    const state = {
        currentLang: 'en',
        fashionData: [],
        filteredData: [],
        currentFilter: { type: 'category', value: 'all' },
        displayedArticles: 13,
        articlesPerLoad: 12
    };

    // ============================================
    // Utility Functions
    // ============================================
    const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));

    const buildArticleUrl = (id, sourceType) => `../article/index.html?category=${sourceType}&id=${id}`;

    function createImageWithSkeleton(src, alt, imgClass = '') {
        return `
            <div class="image-container w-full h-full">
                <div class="skeleton w-full h-full absolute inset-0"></div>
                <img src="${src}"
                     alt="${alt}"
                     class="${imgClass}"
                     loading="lazy"
                     onload="this.classList.add('loaded'); this.previousElementSibling?.remove();"
                     onerror="this.src='https://placehold.co/1200x675/e5e5e5/666666?text=FBC'; this.classList.add('loaded'); this.previousElementSibling?.remove();">
            </div>
        `;
    }

    const createSkeletonCard = () => `
        <div class="animate-pulse">
            <div class="aspect-[3/2] bg-gray-200 rounded-sm mb-4"></div>
            <div class="h-3 bg-gray-200 rounded w-1/3 mb-2"></div>
            <div class="h-4 bg-gray-200 rounded w-full mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-3/4 mb-2"></div>
            <div class="h-3 bg-gray-200 rounded w-1/2"></div>
        </div>
    `;

    // ============================================
    // Language Management
    // ============================================
    function initializeLanguage() {
        const savedLang = sessionStorage.getItem('fbc_language');

        if (savedLang) {
            // 세션에 저장된 언어가 있으면 우선 사용
            state.currentLang = savedLang;
        } else {
            // 없으면 시스템 언어 감지
            const browserLang = navigator.language || navigator.userLanguage;
            state.currentLang = browserLang.toLowerCase().includes('ko') ? 'ko' : 'en';
            sessionStorage.setItem('fbc_language', state.currentLang);
        }

        document.getElementById('lang-text').textContent = state.currentLang === 'ko' ? '한국어' : 'English';
    }

    function setupLanguageToggle() {
        const langToggle = document.getElementById('lang-toggle');
        langToggle.addEventListener('click', () => {
            state.currentLang = state.currentLang === 'en' ? 'ko' : 'en';
            document.getElementById('lang-text').textContent = state.currentLang === 'ko' ? '한국어' : 'English';
            sessionStorage.setItem('fbc_language', state.currentLang);
            updateTexts();
            renderAllSections();
        });
    }

    // ============================================
    // Data Loading from Supabase
    // ============================================
    async function loadFashionData() {
        try {
            const { data, error } = await supabaseClient
                .from('content_items')
                .select('*')
                .eq('source_type', 'fashion')
                .order('date', { ascending: false });

            if (error) throw error;

            state.fashionData = data || [];
            state.filteredData = [...state.fashionData];
        } catch (error) {
            console.error('Error loading fashion data:', error);
            state.fashionData = [];
            state.filteredData = [];
        }
    }

    // ============================================
    // Skeleton Display
    // ============================================
    function showSkeletons() {
        // Hero skeleton
        document.getElementById('hero-article').innerHTML = `
            <div class="relative animate-pulse">
                <div class="aspect-video bg-gray-200 rounded"></div>
                <div class="absolute bottom-8 left-8 right-8">
                    <div class="h-4 bg-gray-300 rounded w-1/4 mb-4"></div>
                    <div class="h-8 bg-gray-300 rounded w-3/4 mb-3"></div>
                    <div class="h-4 bg-gray-300 rounded w-1/2"></div>
                </div>
            </div>
        `;

        // Featured grid skeleton
        document.getElementById('featured-grid').innerHTML = Array(4).fill(createSkeletonCard()).join('');

        // Latest section skeleton
        document.getElementById('latest-articles').innerHTML = Array(8).fill(createSkeletonCard()).join('');
    }

    // ============================================
    // Filter Management
    // ============================================
    function setupFilterButtons() {
        const filterButtons = document.querySelectorAll('[data-filter]');
        filterButtons.forEach(button => {
            button.addEventListener('click', () => {
                const filterType = button.dataset.type;
                const filterValue = button.dataset.filter;

                // Update active state
                document.querySelectorAll(`[data-type="${filterType}"]`).forEach(btn => {
                    btn.classList.remove('bg-black', 'text-white', 'border-black');
                    btn.classList.add('bg-white', 'border-gray-300');
                });
                button.classList.add('bg-black', 'text-white', 'border-black');
                button.classList.remove('bg-white', 'border-gray-300');

                state.currentFilter = { type: filterType, value: filterValue };
                state.displayedArticles = 13;
                applyFilter();
            });
        });
    }

    async function applyFilter() {
        const { type, value } = state.currentFilter;

        if (type === 'category') {
            state.filteredData = value === 'all'
                ? [...state.fashionData]
                : state.fashionData.filter(article => article.category === value);
        } else if (type === 'cultural') {
            state.filteredData = value === 'all'
                ? [...state.fashionData]
                : state.fashionData.filter(article => article.cultural_badge === value);
        }

        state.filteredData.sort((a, b) => new Date(b.date) - new Date(a.date));

        // 순차 로딩
        await renderSequentially();
    }

    // ============================================
    // Render Functions
    // ============================================
    async function renderHeroArticle() {
        const heroContainer = document.getElementById('hero-article');
        if (state.filteredData.length === 0) {
            heroContainer.innerHTML = '';
            return;
        }

        const hero = state.filteredData[0];
        const title = state.currentLang === 'ko' ? hero.title_kor : hero.title_en;
        const desc = state.currentLang === 'ko' ? hero.desc_kor : hero.desc_en;

        // Hero에서는 image_origin_url 사용, 없으면 image로 폴백
        const heroImage = hero.image_origin_url || hero.image;

        heroContainer.innerHTML = `
            <a href="${buildArticleUrl(hero.id, hero.source_type)}" class="block relative group">
                <div class="aspect-video overflow-hidden bg-gray-100 relative">
                    ${createImageWithSkeleton(heroImage, title, 'w-full h-full object-cover')}
                </div>
                <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black/80 to-transparent p-4 md:p-8">
                    <div class="flex items-center gap-2 mb-3">
                        <span class="inline-block px-3 py-1 text-[10px] md:text-[11px] font-semibold uppercase tracking-wide bg-black text-white">${hero.category}</span>
                        ${hero.cultural_badge ? `<span class="inline-block px-2 md:px-3 py-1 text-[9px] md:text-[10px] font-semibold bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-full">${hero.cultural_badge}</span>` : ''}
                    </div>
                    <h2 class="text-xl md:text-3xl lg:text-4xl font-serif font-bold text-white mb-2 break-words">${title}</h2>
                    <p class="text-sm md:text-lg text-white/90 mb-3 line-clamp-2">${desc}</p>
                    <p class="text-xs md:text-sm text-white/70">${hero.date} · ${hero.author}</p>
                </div>
            </a>
        `;
    }

    async function renderFeaturedGrid() {
        const articles = state.filteredData.slice(1, 5);
        document.getElementById('featured-grid').innerHTML = articles.map(article => createArticleCard(article)).join('');
    }

    async function renderLatestStories() {
        const articles = state.filteredData.slice(5, state.displayedArticles);
        const latestSection = document.getElementById('latest-section');
        const loadMoreContainer = document.getElementById('load-more-container');

        if (articles.length === 0) {
            latestSection.classList.add('hidden');
            loadMoreContainer.classList.add('hidden');
            return;
        }

        latestSection.classList.remove('hidden');
        document.getElementById('latest-articles').innerHTML = articles.map(article => createArticleCard(article)).join('');

        loadMoreContainer.classList.toggle('hidden', state.displayedArticles >= state.filteredData.length);
    }

    function createArticleCard(article) {
        const title = state.currentLang === 'ko' ? article.title_kor : article.title_en;
        const desc = state.currentLang === 'ko' ? article.desc_kor : article.desc_en;

        return `
            <article class="fade-in">
                <a href="${buildArticleUrl(article.id, article.source_type)}" class="block group">
                    <div class="aspect-[3/2] overflow-hidden bg-gray-100 mb-4 relative rounded-sm">
                        ${createImageWithSkeleton(article.image, title, 'w-full h-full object-cover group-hover:scale-105 transition-transform duration-500')}
                        ${article.cultural_badge ? `<span class="absolute top-3 left-3 inline-block px-2 md:px-3 py-1 text-[9px] md:text-[10px] font-semibold bg-gradient-to-r from-purple-500 to-purple-700 text-white rounded-full">${article.cultural_badge}</span>` : ''}
                    </div>
                    <div>
                        <span class="text-xs font-semibold uppercase tracking-wide text-gray-700">${article.category}</span>
                        <h3 class="text-base font-bold my-2 group-hover:text-gray-600 transition line-clamp-2">${title}</h3>
                        <p class="text-sm text-gray-600 mb-2 line-clamp-2">${desc}</p>
                        <p class="text-xs text-gray-500">${article.date} · ${article.author}</p>
                    </div>
                </a>
            </article>
        `;
    }

    // ============================================
    // Sequential Loading
    // ============================================
    async function renderSequentially() {
        updateTexts();

        // 1. Show skeletons
        showSkeletons();
        await delay(50);

        // 2. Load Hero
        await renderHeroArticle();
        await delay(100);

        // 3. Load Featured Grid
        await renderFeaturedGrid();
        await delay(100);

        // 4. Load Latest Stories
        await renderLatestStories();
    }

    function renderAllSections() {
        updateTexts();
        renderHeroArticle();
        renderFeaturedGrid();
        renderLatestStories();
    }

    function updateTexts() {
        document.getElementById('load-more-text').textContent = state.currentLang === 'ko' ? '더 보기' : 'Load More';
    }

    // ============================================
    // Load More
    // ============================================
    function setupLoadMore() {
        document.getElementById('load-more').addEventListener('click', () => {
            state.displayedArticles += state.articlesPerLoad;
            renderLatestStories();
        });
    }

    // ============================================
    // Newsletter
    // ============================================
    function setupNewsletter() {
        document.getElementById('newsletter-submit').addEventListener('click', () => {
            const email = document.getElementById('newsletter-email').value;
            if (email && email.includes('@')) {
                alert(state.currentLang === 'ko' ? '구독해 주셔서 감사합니다!' : 'Thank you for subscribing!');
                document.getElementById('newsletter-email').value = '';
            } else {
                alert(state.currentLang === 'ko' ? '유효한 이메일 주소를 입력해주세요.' : 'Please enter a valid email address.');
            }
        });
    }

    // ============================================
    // Initialize
    // ============================================
    async function init() {
        // 1. Initialize language (세션 또는 시스템 언어)
        initializeLanguage();

        // 2. Load data
        await loadFashionData();

        // 3. Setup listeners
        setupLanguageToggle();
        setupFilterButtons();
        setupLoadMore();
        setupNewsletter();

        // 4. Initial render with sequential loading
        await applyFilter();
    }

    document.addEventListener('DOMContentLoaded', init);
</script>

</body>
</html>
