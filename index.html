<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBC Creators Magazine</title>
    <script src="config.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.css"/>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
    * {
        font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
    }
    .font-serif, .font-serif * {
        font-family: 'Noto Serif KR', Georgia, serif !important;
    }

    /* Shimmer 애니메이션 */
    @keyframes shimmer {
        0% {
            background-position: -468px 0;
            transform: translateX(-100%);
        }
        100% {
            background-position: 468px 0;
            transform: translateX(100%);
        }
    }

    /* Skeleton 로딩 */
    .skeleton {
        animation: shimmer 1.2s ease-in-out infinite;
        background: linear-gradient(to right, #f0f0f0 8%, #e0e0e0 18%, #f0f0f0 33%);
        background-size: 800px 104px;
    }

    /* 일반 이미지 컨테이너 */
    .image-container {
        position: relative;
        overflow: hidden;
    }

    .image-container img {
        opacity: 0;
        transition: opacity 0.3s ease-in-out;
    }

    .image-container img.loaded {
        opacity: 1;
    }

    /* Hero 이미지 컨테이너 - Progressive WebP */
    .hero-image-container {
        position: relative;
        width: 100%;
        height: 100%;
        overflow: hidden;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    }

    /* Hero 이미지 기본 스타일 */
    .hero-image {
        width: 100%;
        height: 100%;
        object-fit: cover;
        opacity: 0;
        transition: opacity 0.8s ease-in-out;
    }

    .hero-image.loaded {
        opacity: 1;
    }

    /* Progressive WebP - Blur 효과 */
    .hero-placeholder {
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        object-fit: cover;
        filter: blur(20px);
        transform: scale(1.1);
        transition: opacity 0.8s ease-in-out;
    }

    .hero-placeholder.fade-out {
        opacity: 0;
    }

    /* 로딩 Shimmer 효과 */
    .hero-image-container::before {
        content: '';
        position: absolute;
        inset: 0;
        background: linear-gradient(
            90deg,
            rgba(255,255,255,0) 0%,
            rgba(255,255,255,0.3) 50%,
            rgba(255,255,255,0) 100%
        );
        animation: shimmer 2s infinite;
        z-index: 1;
    }

    .hero-image-container.loaded::before {
        display: none;
    }

    /* Hero 슬라이드 */
    .hero-slide {
        position: absolute;
        inset: 0;
        background-size: cover;
        background-position: center;
        background-repeat: no-repeat;
        opacity: 0;
        transition: opacity 1s ease-in-out;
    }

    .hero-slide.active {
        opacity: 1;
        z-index: 2;
    }

    /* Hero 텍스트 컨텐츠 */
    .hero-content {
        word-break: keep-all;
        text-wrap: balance;
    }

    /* WebP 지원 체크용 */
    .no-webp .hero-image-container {
        background: linear-gradient(135deg, #434343 0%, #000000 100%);
    }

    /* 부드러운 스크롤 */
    html {
        scroll-behavior: smooth;
    }

    /* Hero 인디케이터 */
    .hero-indicator {
        width: 3rem;
        height: 0.25rem;
        background: rgba(255, 255, 255, 0.5);
        transition: all 0.3s ease-in-out;
        cursor: pointer;
    }

    .hero-indicator.active {
        background: rgba(255, 255, 255, 1);
        width: 4rem;
    }

    .hero-indicator:hover {
        background: rgba(255, 255, 255, 0.8);
    }

    /* 반응형 Hero 높이 */
    @media (max-width: 768px) {
        .hero-slide {
            min-height: 60vh;
        }
    }

    @media (min-width: 769px) {
        .hero-slide {
            min-height: 80vh;
        }
    }

    /* 접근성 - Reduced Motion */
    @media (prefers-reduced-motion: reduce) {
        .hero-slide,
        .hero-image,
        .hero-placeholder {
            transition: none;
        }

        .hero-image-container::before {
            animation: none;
        }
    }
    </style>
</head>
<body class="bg-white">

<!-- Header -->
<header class="bg-white border-b sticky top-0 z-50">
    <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-3 items-center py-3 border-b">
            <div class="flex items-center space-x-4 text-xs">
                <button id="lang-toggle" class="px-3 py-1 border border-gray-300 hover:bg-gray-100 transition">
                    <span id="lang-text">English</span>
                </button>
            </div>
            <div class="justify-self-center">
                <a href="index.html" class="hover:opacity-80 transition">
                    <h1 class="text-3xl font-serif font-bold tracking-wider">FBC</h1>
                </a>
            </div>
            <div class="justify-self-end flex items-center space-x-4 text-xs">
                <a href="#newsletter-section" class="hover:text-gray-600">SUBSCRIBE</a>
                <a href="admin/index.html" class="opacity-60 hover:opacity-90 transition-opacity" title="Admin">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="currentColor" class="text-gray-400">
                        <path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/>
                    </svg>
                </a>

            </div>
        </div>
        <nav class="py-4">
            <ul class="flex items-center justify-center space-x-6 md:space-x-8 text-sm font-medium">
                <li><a href="fashion/index.html" class="hover:text-gray-600 transition">FASHION</a></li>
                <li><a href="beauty/index.html" class="hover:text-gray-600 transition">BEAUTY</a></li>
                <li><a href="life/index.html" class="hover:text-gray-600 transition">LIFE</a></li>
                <li><a href="districts/index.html" class="hover:text-gray-600 transition">DISTRICTS</a></li>
            </ul>
        </nav>
    </div>
</header>

<!-- Hero Section -->
<section class="hero-image flex items-center justify-center text-white relative" id="hero-section">
    <div id="hero-slides-container" class="absolute inset-0"></div>
    <div class="hero-content absolute bottom-12 md:bottom-16 left-1/2 -translate-x-1/2 text-center px-4 md:px-8 z-10 w-full max-w-4xl">
        <h2 class="text-2xl md:text-4xl lg:text-5xl font-serif font-bold mb-2" id="hero-title"></h2>
        <p class="text-sm md:text-base opacity-90" id="hero-subtitle"></p>
    </div>
    <div class="absolute bottom-6 md:bottom-8 left-1/2 -translate-x-1/2 flex gap-2 md:gap-3 z-20" id="hero-indicators"></div>
</section>

<!-- Location Section -->
<section class="bg-gradient-to-b from-gray-50 to-gray-100 border-y border-gray-200 py-12 md:py-16">
    <div class="max-w-7xl mx-auto px-4 text-center">
        <h2 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4" id="location-title"></h2>
        <p class="text-base md:text-lg text-gray-600 max-w-2xl mx-auto mb-6" id="location-desc"></p>
        <button id="change-location" class="px-6 py-2 bg-black text-white font-semibold rounded hover:bg-gray-800 transition">
            📍 Change Location
        </button>
    </div>
</section>

<!-- Fashion Section -->
<section class="max-w-7xl mx-auto px-4 py-12 md:py-16">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-sm font-bold uppercase tracking-widest border-b-2 border-black pb-2" id="fashion-location-title">Fashion</h2>
        <a href="fashion/index.html" class="text-sm hover:underline">View All →</a>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="fashion-grid"></div>
</section>

<!-- Beauty Section -->
<section class="max-w-7xl mx-auto px-4 pb-12 md:pb-16">
    <div class="flex items-center justify-between mb-6">
        <h2 class="text-sm font-bold uppercase tracking-widest border-b-2 border-black pb-2" id="beauty-location-title">Beauty</h2>
        <a href="beauty/index.html" class="text-sm hover:underline">View All →</a>
    </div>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="beauty-grid"></div>
</section>

<!-- Today's Stories -->
<section class="max-w-7xl mx-auto px-4 pb-12 md:pb-16">
    <h2 class="text-sm font-bold uppercase tracking-widest border-b-2 border-black pb-2 mb-6">Today's Stories</h2>
    <div class="grid grid-cols-1 md:grid-cols-12 gap-6" id="today-stories"></div>
</section>

<!-- Best Stories -->
<section class="max-w-7xl mx-auto px-4 pb-12 md:pb-16">
    <h2 class="text-sm font-bold uppercase tracking-widest border-b-2 border-black pb-2 mb-6">Best Stories</h2>
    <div class="swiper best-stories-swiper overflow-hidden -mx-4 px-4">
        <div class="swiper-wrapper" id="best-stories"></div>
    </div>
</section>

<!-- Must Read -->
<section class="max-w-7xl mx-auto px-4 pb-12 md:pb-16">
    <h2 class="text-sm font-bold uppercase tracking-widest border-b-2 border-black pb-2 mb-6">Must Read</h2>
    <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-6" id="must-read"></div>
</section>

<!-- Latest Stories -->
<section class="max-w-7xl mx-auto px-4 pb-12 md:pb-16">
    <h2 class="text-sm font-bold uppercase tracking-widest border-b-2 border-black pb-2 mb-6">Latest Stories</h2>
    <div class="grid grid-cols-1 md:grid-cols-3 gap-8" id="latest-stories"></div>
</section>

<!-- Footer -->
<footer class="bg-black text-white py-12">
    <div class="max-w-7xl mx-auto px-4">
        <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
            <div>
                <h3 class="font-serif text-2xl font-bold mb-4">FBC</h3>
                <p class="text-sm text-gray-400">Fashion, Beauty, Culture<br>with Cultural Translation</p>
            </div>
            <div>
                <h4 class="font-bold mb-3 text-sm">CATEGORIES</h4>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="fashion/index.html" class="hover:text-white">Fashion</a></li>
                    <li><a href="beauty/index.html" class="hover:text-white">Beauty</a></li>
                    <li><a href="life/index.html" class="hover:text-white">Life & Culture</a></li>
                    <li><a href="districts/index.html" class="hover:text-white">Districts</a></li>
                </ul>
            </div>
            <div>
                <h4 class="font-bold mb-3 text-sm">ABOUT</h4>
                <ul class="space-y-2 text-sm text-gray-400">
                    <li><a href="about/index.html" class="hover:text-white">About FBC</a></li>
                </ul>
            </div>
            <div id="newsletter-section">
                <h4 class="font-bold mb-3 text-sm">NEWSLETTER</h4>
                <p class="text-sm text-gray-400 mb-3">Get weekly K-fashion insights</p>
                <div class="flex">
                    <input type="email" id="newsletter-email" placeholder="Your email" class="px-3 py-2 bg-gray-800 text-sm flex-1 focus:outline-none">
                    <button id="newsletter-submit" class="px-4 py-2 bg-white text-black text-sm font-medium">→</button>
                </div>
            </div>
        </div>
        <div class="border-t border-gray-800 pt-6 text-center text-xs text-gray-500">
            © 2025 FBC Creators. All rights reserved.
        </div>
    </div>
</footer>

<!-- Location Modal -->
<div id="location-modal" class="hidden fixed inset-0 bg-black/50 z-50 flex items-center justify-center p-4">
    <div class="bg-white rounded-lg max-w-md w-full p-6">
        <h3 class="text-xl font-bold mb-4">Select Your Location</h3>
        <div class="space-y-3" id="location-options"></div>
        <button id="close-location-modal" class="mt-4 w-full py-2 bg-gray-200 rounded hover:bg-gray-300 transition">Cancel</button>
    </div>
</div>
<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<script type="module">
    // ============================================
    // Supabase Configuration
    // ============================================
    const SUPABASE_URL = window.ENV.SUPABASE_URL;
    const SUPABASE_ANON_KEY = window.ENV.SUPABASE_ANON_KEY;

    const { createClient } = supabase;
    const supabaseClient = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    // ============================================
    // Progressive WebP Image Loader
    // ============================================
    class ProgressiveImageLoader {
        constructor() {
            this.loadedImages = new Map();
            this.observers = new Map();
            this.webpSupport = null;
        }

        // WebP 지원 여부 확인
        async supportsWebP() {
            if (this.webpSupport !== null) return this.webpSupport;

            return new Promise((resolve) => {
                const webP = new Image();
                webP.onload = webP.onerror = () => {
                    this.webpSupport = (webP.height === 2);
                    resolve(this.webpSupport);
                };
                webP.src = 'data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA';
            });
        }

        // Progressive WebP 로딩
        async loadProgressiveImage(imageUrl, container, options = {}) {
            const {
                placeholderClass = 'hero-placeholder',
                transitionDuration = 800,
                onLoad = null,
                priority = false,
                alt = ''
            } = options;

            const supportsWebP = await this.supportsWebP();

            // 저화질 플레이스홀더 URL 생성
            const lowQualityUrl = this.getLowQualityUrl(imageUrl);
            const highQualityUrl = supportsWebP ? imageUrl : this.getFallbackUrl(imageUrl);

            // 컨테이너 클래스 추가
            if (!supportsWebP) {
                document.documentElement.classList.add('no-webp');
            }

            // 저화질 이미지 먼저 로드
            const placeholder = document.createElement('img');
            placeholder.src = lowQualityUrl;
            placeholder.className = placeholderClass;
            placeholder.alt = alt;
            placeholder.loading = 'eager';
            container.appendChild(placeholder);

            // 고화질 이미지 로드
            const highQualityImg = new Image();

            return new Promise((resolve, reject) => {
                highQualityImg.onload = () => {
                    const finalImg = document.createElement('img');
                    finalImg.src = highQualityUrl;
                    finalImg.alt = alt;
                    finalImg.className = 'hero-image';

                    container.appendChild(finalImg);
                    container.classList.add('loaded');

                    // Fade in 효과
                    requestAnimationFrame(() => {
                        finalImg.classList.add('loaded');
                        placeholder.classList.add('fade-out');

                        setTimeout(() => {
                            placeholder.remove();
                            if (onLoad) onLoad(finalImg);
                            resolve(finalImg);
                        }, transitionDuration);
                    });
                };

                highQualityImg.onerror = (error) => {
                    console.error('Failed to load image:', highQualityUrl);
                    // Fallback: 플레이스홀더를 그대로 사용
                    placeholder.classList.remove(placeholderClass);
                    placeholder.style.filter = 'blur(0)';
                    reject(error);
                };

                // Priority가 높으면 즉시 로드, 아니면 Intersection Observer 사용
                if (priority) {
                    highQualityImg.src = highQualityUrl;
                } else {
                    this.lazyLoad(highQualityImg, highQualityUrl, container);
                }
            });
        }

        // Lazy loading with Intersection Observer
        lazyLoad(img, src, container) {
            const observer = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if (entry.isIntersecting) {
                        img.src = src;
                        observer.unobserve(container);
                    }
                });
            }, {
                rootMargin: '100px',
                threshold: 0.01
            });

            observer.observe(container);
            this.observers.set(container, observer);
        }

        // 저화질 URL 생성 (Supabase transform 사용)
        getLowQualityUrl(url) {
            if (url.includes('supabase')) {
                const urlObj = new URL(url);
                urlObj.searchParams.set('width', '50');
                urlObj.searchParams.set('quality', '20');
                urlObj.searchParams.set('format', 'webp');
                return urlObj.toString();
            }
            return url;
        }

        // WebP 미지원 시 fallback URL
        getFallbackUrl(url) {
            if (url.endsWith('.webp')) {
                return url.replace('.webp', '.jpg');
            }
            return url;
        }

        // 프리로드
        preloadImage(url) {
            const link = document.createElement('link');
            link.rel = 'preload';
            link.as = 'image';
            link.href = url;
            document.head.appendChild(link);
        }

        // 모든 observer 정리
        cleanup() {
            this.observers.forEach(observer => observer.disconnect());
            this.observers.clear();
        }
    }

    // Progressive Image Loader 인스턴스 생성
    const imageLoader = new ProgressiveImageLoader();

    // ============================================
    // State Management
    // ============================================
    const state = {
        currentLang: 'en',
        currentDistrict: 'dsm00001',
        currentHeroIndex: 0,
        heroInterval: null,
        heroSlides: [],
        autoSelectEnabled: true,
        data: {
            allContent: [],
            districtMeta: [
                { district_id: "dsm00001", name_kor: "성수동", name_en: "Seongsu-dong", title_kor: "성수동", title_en: "Seongsu-dong", desc_kor: "트렌디한 카페와 힙한 패션", desc_en: "Trendy cafes and hip fashion", latitude: 37.5447, longitude: 127.0557 },
                { district_id: "dsm00002", name_kor: "한남동", name_en: "Hannam-dong", title_kor: "한남동", title_en: "Hannam-dong", desc_kor: "럭셔리 브랜드와 고급 문화", desc_en: "Luxury brands and upscale culture", latitude: 37.5347, longitude: 127.0024 },
                { district_id: "dsm00003", name_kor: "홍대", name_en: "Hongdae", title_kor: "홍대", title_en: "Hongdae", desc_kor: "예술과 젊음의 거리", desc_en: "Street of art and youth", latitude: 37.5563, longitude: 126.9236 },
                { district_id: "dsm00004", name_kor: "명동", name_en: "Myeongdong", title_kor: "명동", title_en: "Myeongdong", desc_kor: "뷰티와 쇼핑의 중심", desc_en: "Center of beauty and shopping", latitude: 37.5636, longitude: 126.9836 }
            ]
        }
    };

    // ============================================
    // Hero Section with Progressive WebP
    // ============================================
    async function renderHeroSection() {
        const heroSlider = document.getElementById('hero-slider');
        const heroIndicators = document.getElementById('hero-indicators');

        if (!heroSlider || !heroIndicators) {
            console.warn('Hero elements not found');
            return;
        }

        heroSlider.innerHTML = '';
        heroIndicators.innerHTML = '';

        // 첫 번째 이미지 프리로드
        if (state.heroSlides.length > 0 && state.heroSlides[0].img) {
            imageLoader.preloadImage(state.heroSlides[0].img);
        }

        for (let index = 0; index < state.heroSlides.length; index++) {
            const slide = state.heroSlides[index];

            // Hero Slide 생성
            const slideDiv = document.createElement('div');
            slideDiv.className = `hero-slide ${index === 0 ? 'active' : ''}`;
            slideDiv.setAttribute('data-slide-index', index);

            // 이미지 컨테이너
            const imageContainer = document.createElement('div');
            imageContainer.className = 'hero-image-container';

            // Progressive WebP 이미지 로드
            imageLoader.loadProgressiveImage(slide.img, imageContainer, {
                alt: state.currentLang === 'ko' ? slide.title_kor : slide.title_en,
                priority: index === 0, // 첫 번째 슬라이드는 우선 로드
                transitionDuration: 800,
                onLoad: (img) => {
                    console.log(`Hero image ${index + 1} loaded:`, slide.img);
                }
            }).catch(error => {
                console.error(`Failed to load hero image ${index + 1}:`, error);
            });

            // 오버레이 및 텍스트
            const overlay = document.createElement('div');
            overlay.className = 'absolute inset-0 bg-gradient-to-b from-black/40 via-black/30 to-black/60';
            overlay.innerHTML = `
                <div class="absolute inset-0 flex items-center justify-center text-center px-4">
                    <div class="text-white max-w-4xl hero-content">
                        <h2 class="text-4xl md:text-6xl font-serif font-bold mb-4 drop-shadow-lg"
                            data-ko="${slide.title_kor}"
                            data-en="${slide.title_en}">
                            ${state.currentLang === 'ko' ? slide.title_kor : slide.title_en}
                        </h2>
                        <p class="text-lg md:text-xl mb-8 font-light drop-shadow-md"
                           data-ko="${slide.subtitle_kor || ''}"
                           data-en="${slide.subtitle_en || ''}">
                            ${state.currentLang === 'ko' ? (slide.subtitle_kor || '') : (slide.subtitle_en || '')}
                        </p>
                        <a href="article/index.html?id=${slide.article_id}"
                           class="inline-block px-8 py-3 bg-white text-black hover:bg-gray-100 transition-all duration-300 font-medium shadow-lg hover:shadow-xl transform hover:scale-105">
                            READ MORE
                        </a>
                    </div>
                </div>
            `;

            slideDiv.appendChild(imageContainer);
            slideDiv.appendChild(overlay);
            heroSlider.appendChild(slideDiv);

            // Indicator 생성
            const indicator = document.createElement('button');
            indicator.className = `hero-indicator ${index === 0 ? 'active' : ''}`;
            indicator.setAttribute('aria-label', `Go to slide ${index + 1}`);
            indicator.onclick = () => changeHeroSlide(index);
            heroIndicators.appendChild(indicator);
        }

        // Auto-play 시작
        startHeroAutoPlay();
    }

    function changeHeroSlide(index) {
        const slides = document.querySelectorAll('.hero-slide');
        const indicators = document.querySelectorAll('.hero-indicator');

        slides.forEach((slide, i) => {
            if (i === index) {
                slide.classList.add('active');
            } else {
                slide.classList.remove('active');
            }
        });

        indicators.forEach((indicator, i) => {
            if (i === index) {
                indicator.classList.add('active');
            } else {
                indicator.classList.remove('active');
            }
        });

        state.currentHeroIndex = index;
    }

    function startHeroAutoPlay() {
        stopHeroAutoPlay();
        if (state.heroSlides.length > 1) {
            state.heroInterval = setInterval(() => {
                const nextIndex = (state.currentHeroIndex + 1) % state.heroSlides.length;
                changeHeroSlide(nextIndex);
            }, 5000);
        }
    }

    function stopHeroAutoPlay() {
        if (state.heroInterval) {
            clearInterval(state.heroInterval);
            state.heroInterval = null;
        }
    }

    // Hero 호버 시 auto-play 일시정지
    document.addEventListener('DOMContentLoaded', () => {
        const heroSlider = document.getElementById('hero-slider');
        if (heroSlider) {
            heroSlider.addEventListener('mouseenter', stopHeroAutoPlay);
            heroSlider.addEventListener('mouseleave', startHeroAutoPlay);
        }
    });

    // ============================================
    // Data Loading
    // ============================================
    async function loadAllData() {
        try {
            const [articlesResponse, pinnedResponse] = await Promise.all([
                supabaseClient.from('article').select('*'),
                supabaseClient.from('pinned').select('*').single()
            ]);

            if (articlesResponse.error) throw articlesResponse.error;
            if (pinnedResponse.error) throw pinnedResponse.error;

            state.data.allContent = articlesResponse.data;

            // Hero 슬라이드 데이터 구성
            if (pinnedResponse.data && pinnedResponse.data.hero) {
                state.heroSlides = pinnedResponse.data.hero.map(heroId => {
                    const article = state.data.allContent.find(a => a.article_id === heroId);
                    return article || null;
                }).filter(Boolean);
            }

            console.log('Loaded hero slides:', state.heroSlides.length);
            await renderHeroSection();
            renderAllSections();
        } catch (error) {
            console.error('Error loading data:', error);
        }
    }

    // ============================================
    // Language Toggle
    // ============================================
    function updateLanguage() {
        document.querySelectorAll('[data-ko][data-en]').forEach(el => {
            el.textContent = state.currentLang === 'ko' ? el.dataset.ko : el.dataset.en;
        });

        const langButton = document.getElementById('lang-text');
        if (langButton) {
            langButton.textContent = state.currentLang === 'ko' ? 'English' : '한국어';
        }
    }

    document.getElementById('lang-toggle')?.addEventListener('click', () => {
        state.currentLang = state.currentLang === 'ko' ? 'en' : 'ko';
        updateLanguage();
    });

    // ============================================
    // Other Sections Rendering
    // ============================================
    function renderAllSections() {
        console.log('Rendering all sections...');
        // 여기에 다른 섹션 렌더링 코드 추가
    }

    // ============================================
    // Performance Monitoring
    // ============================================
    if (window.performance && window.performance.measure) {
        window.addEventListener('load', () => {
            const perfData = window.performance.timing;
            const pageLoadTime = perfData.loadEventEnd - perfData.navigationStart;
            console.log('Page load time:', pageLoadTime + 'ms');
        });
    }

    // ============================================
    // Cleanup on Page Unload
    // ============================================
    window.addEventListener('beforeunload', () => {
        stopHeroAutoPlay();
        imageLoader.cleanup();
    });

    // ============================================
    // Initialize
    // ============================================
    document.addEventListener('DOMContentLoaded', () => {
        loadAllData();
    });
</script>

</body>
</html>