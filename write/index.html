<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>콘텐츠 발행 에디터</title>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap');
        
        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
        }
        
        /* Notion-like Tiptap Editor Styles */
        .tiptap-editor-wrapper {
            @apply border border-gray-200 rounded-lg overflow-hidden bg-white shadow-sm;
        }
        
        .tiptap-menubar {
            @apply sticky top-0 z-10 bg-white border-b border-gray-200 px-4 py-2 flex items-center gap-1 flex-wrap;
        }
        
        .tiptap-menubar button {
            @apply px-3 py-1.5 text-sm rounded hover:bg-gray-100 transition-colors duration-150 font-medium text-gray-700 border border-transparent;
        }
        
        .tiptap-menubar button:hover {
            @apply bg-gray-100 border-gray-200;
        }
        
        .tiptap-menubar button.is-active {
            @apply bg-blue-50 text-blue-600 border-blue-200;
        }
        
        .ProseMirror {
            @apply outline-none px-16 py-12 min-h-[500px] max-h-[600px] overflow-y-auto;
        }
        
        /* Notion-like content styling */
        .ProseMirror p {
            @apply mb-2 text-gray-800 leading-relaxed;
        }
        
        .ProseMirror p.is-editor-empty:first-child::before {
            @apply text-gray-400;
            content: attr(data-placeholder);
            float: left;
            height: 0;
            pointer-events: none;
        }
        
        .ProseMirror h1 {
            @apply text-4xl font-bold mt-8 mb-4 text-gray-900;
        }
        
        .ProseMirror h2 {
            @apply text-3xl font-bold mt-6 mb-3 text-gray-900;
        }
        
        .ProseMirror h3 {
            @apply text-2xl font-semibold mt-4 mb-2 text-gray-900;
        }
        
        .ProseMirror ul,
        .ProseMirror ol {
            @apply pl-6 my-3;
        }
        
        .ProseMirror ul li {
            @apply list-disc mb-1;
        }
        
        .ProseMirror ol li {
            @apply list-decimal mb-1;
        }
        
        .ProseMirror blockquote {
            @apply border-l-4 border-gray-300 pl-4 my-4 italic text-gray-700;
        }
        
        .ProseMirror code {
            @apply bg-gray-100 text-red-600 px-1.5 py-0.5 rounded text-sm font-mono;
        }
        
        .ProseMirror pre {
            @apply bg-gray-900 text-gray-100 rounded-lg p-4 my-4 overflow-x-auto;
        }
        
        .ProseMirror pre code {
            @apply bg-transparent text-gray-100 p-0;
        }
        
        .ProseMirror img {
            @apply max-w-full h-auto rounded-lg my-4 shadow-md;
        }
        
        .ProseMirror strong {
            @apply font-bold text-gray-900;
        }
        
        .ProseMirror em {
            @apply italic;
        }
        
        .ProseMirror a {
            @apply text-blue-600 underline hover:text-blue-700;
        }
        
        /* User Type Selector */
        .user-type-btn {
            @apply relative px-6 py-3 rounded-lg font-medium transition-all duration-200 cursor-pointer;
        }
        
        .user-type-btn input[type="radio"] {
            @apply sr-only;
        }
        
        .user-type-btn:has(input:not(:checked)) {
            @apply bg-gray-100 text-gray-600 hover:bg-gray-200;
        }
        
        .user-type-btn:has(input:checked) {
            @apply bg-gradient-to-r from-blue-500 to-purple-600 text-white shadow-lg transform scale-105;
        }
        
        /* Loading Animation */
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .animate-spin {
            animation: spin 1s linear infinite;
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="bg-white border-b border-gray-200 shadow-sm sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between items-center h-16">
                <div class="flex items-center space-x-3">
                    <div class="w-10 h-10 bg-gradient-to-br from-blue-500 to-purple-600 rounded-lg flex items-center justify-center">
                        <svg class="w-6 h-6 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"></path>
                        </svg>
                    </div>
                    <div>
                        <h1 class="text-xl font-bold text-gray-900">콘텐츠 발행 에디터</h1>
                        <p class="text-xs text-gray-500">Content Publishing Editor</p>
                    </div>
                </div>
                <div class="flex items-center space-x-4">
                    <span class="text-sm text-gray-600">버전 2.0</span>
                    <div class="w-2 h-2 bg-green-500 rounded-full animate-pulse" title="시스템 정상"></div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
        <!-- Loading Indicator -->
        <div id="loadingIndicator" class="flex flex-col items-center justify-center py-20">
            <div class="w-16 h-16 border-4 border-blue-200 border-t-blue-600 rounded-full animate-spin"></div>
            <p class="mt-4 text-gray-600 font-medium">📁 JSON 데이터를 불러오는 중...</p>
        </div>

        <!-- Form Container -->
        <div id="formContainer" class="hidden">
            <!-- User Type Selector -->
            <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8 mb-6">
                <h2 class="text-lg font-semibold text-gray-900 mb-4">사용자 유형 선택</h2>
                <div class="flex gap-4">
                    <label class="user-type-btn flex-1">
                        <input type="radio" name="userType" value="developer" checked>
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 20l4-16m4 4l4 4-4 4M6 16l-4-4 4-4"></path>
                            </svg>
                            <span>개발자</span>
                        </div>
                    </label>
                    <label class="user-type-btn flex-1">
                        <input type="radio" name="userType" value="general">
                        <div class="flex items-center justify-center space-x-2">
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                            </svg>
                            <span>일반인</span>
                        </div>
                    </label>
                </div>
            </div>

            <!-- Main Form -->
            <form id="contentForm" class="space-y-6">
                <!-- 기본 정보 섹션 -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 pb-3 border-b border-gray-200">기본 정보</h2>
                    
                    <!-- Category -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            카테고리 선택 <span class="text-red-500">*</span>
                        </label>
                        <select id="category" name="category" required 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                            <option value="">-- 카테고리를 선택하세요 --</option>
                            <option value="fashion">Fashion</option>
                            <option value="beauty">Beauty</option>
                            <option value="life">Life</option>
                            <option value="districts">Districts</option>
                        </select>
                    </div>

                    <!-- isPinned -->
                    <div class="mb-6">
                        <label class="flex items-center space-x-3 cursor-pointer">
                            <input type="checkbox" id="isPinned" name="isPinned" 
                                   class="w-5 h-5 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                            <span class="text-sm font-semibold text-gray-700">메인 페이지에 고정 (Pinned)</span>
                        </label>
                    </div>

                    <!-- Pinned Types -->
                    <div id="pinnedTypeGroup" class="hidden mb-6 pl-8 border-l-4 border-blue-200">
                        <label class="block text-sm font-semibold text-gray-700 mb-3">Pinned 타입 선택 (다중 선택 가능)</label>
                        <div class="space-y-2">
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="pinnedType" value="hero" 
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Hero</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="pinnedType" value="todaysStories" 
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Today's Stories</span>
                            </label>
                            <label class="flex items-center space-x-2 cursor-pointer">
                                <input type="checkbox" name="pinnedType" value="mustRead" 
                                       class="w-4 h-4 text-blue-600 border-gray-300 rounded focus:ring-blue-500">
                                <span class="text-sm text-gray-700">Must Read</span>
                            </label>
                        </div>
                    </div>

                    <!-- Titles -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                제목 (한국어) <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="titleKo" name="titleKo" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                   placeholder="한국어 제목을 입력하세요">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                제목 (English) <span class="text-red-500">*</span>
                            </label>
                            <div class="flex gap-2">
                                <input type="text" id="titleEn" name="titleEn" required 
                                       class="flex-1 px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                       placeholder="Enter English title">
                                <button type="button" onclick="copyFromKorean('title')" 
                                        class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition whitespace-nowrap">
                                    🌐 복사
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Descriptions -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                설명 (한국어) <span class="text-red-500">*</span>
                            </label>
                            <textarea id="descriptionKo" name="descriptionKo" required rows="3"
                                      class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                      placeholder="한국어 설명을 입력하세요"></textarea>
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                설명 (English) <span class="text-red-500">*</span>
                            </label>
                            <div class="flex flex-col gap-2">
                                <textarea id="descriptionEn" name="descriptionEn" required rows="3"
                                          class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                          placeholder="Enter English description"></textarea>
                                <button type="button" onclick="copyFromKorean('description')" 
                                        class="self-end px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm">
                                    🌐 복사
                                </button>
                            </div>
                        </div>
                    </div>

                    <!-- Subcategory & Author -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                카테고리 세부 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="subcategory" name="subcategory" pattern="[a-zA-Z0-9-_]+" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                   placeholder="영어/숫자만 입력">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">
                                작성자 <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="author" name="author" pattern="[a-zA-Z0-9-_]+" required 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                   placeholder="영어/숫자만 입력">
                        </div>
                    </div>

                    <!-- Thumbnail Image -->
                    <div class="mb-6">
                        <label class="block text-sm font-semibold text-gray-700 mb-2">
                            썸네일 이미지 <span class="text-red-500">*</span>
                        </label>
                        <input type="file" id="thumbnailImage" name="thumbnailImage" accept=".jpg,.jpeg,.png" required 
                               class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                        <div id="thumbnailPreview" class="mt-4"></div>
                    </div>

                    <!-- Cultural Badge & Tags -->
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">Cultural Badge (선택)</label>
                            <input type="text" id="culturalBadge" name="culturalBadge" pattern="[a-zA-Z0-9-_]+" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                   placeholder="영어/숫자만 입력">
                        </div>
                        <div>
                            <label class="block text-sm font-semibold text-gray-700 mb-2">태그 (쉼표로 구분)</label>
                            <input type="text" id="tags" name="tags" 
                                   class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition"
                                   placeholder="tag1, tag2, tag3">
                        </div>
                    </div>

                    <!-- Related District -->
                    <div>
                        <label class="block text-sm font-semibold text-gray-700 mb-2">관련 지역 (선택)</label>
                        <select id="relatedDistrict" name="relatedDistrict" 
                                class="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent transition">
                            <option value="">-- 지역을 선택하세요 --</option>
                        </select>
                    </div>
                </div>

                <!-- 본문 내용 (한국어) -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
                    <h2 class="text-xl font-bold text-gray-900 mb-6 pb-3 border-b border-gray-200">
                        본문 내용 (한국어) <span class="text-red-500">*</span>
                    </h2>
                    <div class="tiptap-editor-wrapper">
                        <div class="tiptap-menubar" id="menubarKo"></div>
                        <div id="contentKo"></div>
                    </div>
                </div>

                <!-- 본문 내용 (English) -->
                <div class="bg-white rounded-xl shadow-sm border border-gray-200 p-8">
                    <div class="flex justify-between items-center mb-6 pb-3 border-b border-gray-200">
                        <h2 class="text-xl font-bold text-gray-900">
                            본문 내용 (English) <span class="text-red-500">*</span>
                        </h2>
                        <button type="button" onclick="copyFromKorean('content')" 
                                class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition text-sm">
                            🌐 한국어 본문에서 가져오기
                        </button>
                    </div>
                    <div class="tiptap-editor-wrapper">
                        <div class="tiptap-menubar" id="menubarEn"></div>
                        <div id="contentEn"></div>
                    </div>
                </div>

                <!-- Action Buttons -->
                <div class="flex justify-end gap-4">
                    <button type="button" onclick="resetForm()" 
                            class="px-6 py-3 bg-gray-100 text-gray-700 rounded-lg hover:bg-gray-200 transition font-medium">
                        초기화
                    </button>
                    <button type="submit" 
                            class="px-8 py-3 bg-gradient-to-r from-blue-500 to-purple-600 text-white rounded-lg hover:from-blue-600 hover:to-purple-700 transition font-medium shadow-lg">
                        발행하기
                    </button>
                </div>
            </form>

            <p class="text-sm text-gray-500 text-center mt-8">
                * 발행하면 등록 요청 파일(TXT)과 이미지가 다운로드됩니다.
            </p>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-white border-t border-gray-200 mt-20">
        <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">시스템 정보</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li>버전: 2.0.0</li>
                        <li>에디터: Tiptap (Notion-like)</li>
                        <li>프레임워크: Tailwind CSS</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">지원 형식</h3>
                    <ul class="space-y-2 text-sm text-gray-600">
                        <li>이미지: JPG, JPEG, PNG</li>
                        <li>출력: JSON, TXT</li>
                        <li>카테고리: 4개 (Fashion, Beauty, Life, Districts)</li>
                    </ul>
                </div>
                <div>
                    <h3 class="text-sm font-semibold text-gray-900 mb-3">문의</h3>
                    <p class="text-sm text-gray-600">
                        기술 지원이 필요하시면<br>
                        개발팀에 문의해주세요.
                    </p>
                </div>
            </div>
            <div class="mt-8 pt-8 border-t border-gray-200 text-center text-sm text-gray-500">
                © 2025 Content Publishing System. All rights reserved.
            </div>
        </div>
    </footer>

    <script type="module">
        import { Editor } from 'https://esm.sh/@tiptap/core@2.1.13';
        import StarterKit from 'https://esm.sh/@tiptap/starter-kit@2.1.13';
        import Image from 'https://esm.sh/@tiptap/extension-image@2.1.13';
        import Placeholder from 'https://esm.sh/@tiptap/extension-placeholder@2.1.13';

        let editorKo, editorEn;
        let fashionData = [];
        let beautyData = [];
        let lifeData = [];
        let districtsData = [];

        // JSON 데이터 로드 함수 (강화된 에러 핸들링)
        async function loadJSONData() {
            const loadingIndicator = document.getElementById('loadingIndicator');
            
            try {
                console.log('🚀 JSON 파일 로드 시작...');
                
                // 각 JSON 파일을 안전하게 로드
                const loadFile = async (filename) => {
                    try {
                        const response = await fetch(`./${filename}`);
                        if (!response.ok) {
                            console.warn(`⚠️ ${filename} 로드 실패 (${response.status}), 빈 배열 사용`);
                            return [];
                        }
                        const data = await response.json();
                        console.log(`✅ ${filename} 로드 성공: ${data.length}개 항목`);
                        return data;
                    } catch (error) {
                        console.warn(`⚠️ ${filename} 로드 실패:`, error.message, '- 빈 배열 사용');
                        return [];
                    }
                };

                // 모든 JSON 파일 병렬 로드
                [fashionData, beautyData, lifeData, districtsData] = await Promise.all([
                    loadFile('fashion.json'),
                    loadFile('beauty.json'),
                    loadFile('life.json'),
                    loadFile('districts.json')
                ]);

                // 지역 선택 옵션 추가
                if (districtsData.length > 0) {
                    const districtSelect = document.getElementById('relatedDistrict');
                    districtsData.forEach(district => {
                        const option = document.createElement('option');
                        option.value = district.id;
                        option.textContent = `${district.nameKo} (${district.nameEn})`;
                        districtSelect.appendChild(option);
                    });
                    console.log(`✅ 지역 옵션 ${districtsData.length}개 추가됨`);
                }

                console.log('✅ JSON 로드 완료, 에디터 초기화 중...');
                
                // UI 전환
                loadingIndicator.classList.add('hidden');
                document.getElementById('formContainer').classList.remove('hidden');
                
                // 에디터 초기화
                await initializeEditors();
                
                console.log('✅ 시스템 초기화 완료!');
                
            } catch (error) {
                console.error('❌ JSON 로드 중 치명적 오류:', error);
                loadingIndicator.innerHTML = `
                    <div class="bg-red-50 border border-red-200 rounded-lg p-6 max-w-md mx-auto">
                        <div class="flex items-center space-x-3 mb-3">
                            <svg class="w-6 h-6 text-red-600" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4m0 4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            <strong class="text-red-800">데이터 로드 실패</strong>
                        </div>
                        <p class="text-sm text-red-700 mb-2">오류: ${error.message}</p>
                        <p class="text-xs text-red-600">JSON 파일이 없어도 에디터는 사용 가능합니다. 잠시 후 자동으로 진행됩니다...</p>
                    </div>
                `;
                
                // 오류가 있어도 2초 후 에디터 표시
                setTimeout(() => {
                    loadingIndicator.classList.add('hidden');
                    document.getElementById('formContainer').classList.remove('hidden');
                    initializeEditors();
                }, 2000);
            }
        }

        // Tiptap 에디터 초기화 (Notion-like 스타일)
        async function initializeEditors() {
            try {
                console.log('🎨 Notion-like 에디터 초기화 중...');
                
                // 한국어 에디터
                editorKo = new Editor({
                    element: document.querySelector('#contentKo'),
                    extensions: [
                        StarterKit.configure({
                            heading: {
                                levels: [1, 2, 3]
                            }
                        }),
                        Image.configure({
                            inline: true,
                            allowBase64: true
                        }),
                        Placeholder.configure({
                            placeholder: '여기에 내용을 작성하세요... "/" 를 입력하면 명령어를 사용할 수 있습니다.'
                        })
                    ],
                    editorProps: {
                        attributes: {
                            class: 'prose prose-sm sm:prose lg:prose-lg focus:outline-none'
                        }
                    },
                    content: '',
                    editable: true,
                    autofocus: false
                });

                // 영어 에디터
                editorEn = new Editor({
                    element: document.querySelector('#contentEn'),
                    extensions: [
                        StarterKit.configure({
                            heading: {
                                levels: [1, 2, 3]
                            }
                        }),
                        Image.configure({
                            inline: true,
                            allowBase64: true
                        }),
                        Placeholder.configure({
                            placeholder: 'Type "/" for commands...'
                        })
                    ],
                    editorProps: {
                        attributes: {
                            class: 'prose prose-sm sm:prose lg:prose-lg focus:outline-none'
                        }
                    },
                    content: '',
                    editable: true,
                    autofocus: false
                });

                // 메뉴바 생성
                createMenuBar('menubarKo', editorKo);
                createMenuBar('menubarEn', editorEn);
                
                console.log('✅ 에디터 초기화 완료');
            } catch (error) {
                console.error('❌ 에디터 초기화 오류:', error);
                alert('에디터 초기화 중 오류가 발생했습니다: ' + error.message);
            }
        }

        // 메뉴바 생성
        function createMenuBar(containerId, editor) {
            const container = document.getElementById(containerId);
            
            const buttonGroups = [
                [
                    { icon: 'B', command: () => editor.chain().focus().toggleBold().run(), isActive: 'bold', title: 'Bold (Ctrl+B)' },
                    { icon: 'I', command: () => editor.chain().focus().toggleItalic().run(), isActive: 'italic', title: 'Italic (Ctrl+I)' },
                    { icon: 'S', command: () => editor.chain().focus().toggleStrike().run(), isActive: 'strike', title: 'Strikethrough' }
                ],
                [
                    { icon: 'H1', command: () => editor.chain().focus().toggleHeading({ level: 1 }).run(), isActive: 'heading', title: 'Heading 1' },
                    { icon: 'H2', command: () => editor.chain().focus().toggleHeading({ level: 2 }).run(), isActive: 'heading', title: 'Heading 2' },
                    { icon: 'H3', command: () => editor.chain().focus().toggleHeading({ level: 3 }).run(), isActive: 'heading', title: 'Heading 3' }
                ],
                [
                    { icon: '•', command: () => editor.chain().focus().toggleBulletList().run(), isActive: 'bulletList', title: 'Bullet List' },
                    { icon: '1.', command: () => editor.chain().focus().toggleOrderedList().run(), isActive: 'orderedList', title: 'Numbered List' }
                ],
                [
                    { icon: '"', command: () => editor.chain().focus().toggleBlockquote().run(), isActive: 'blockquote', title: 'Quote' },
                    { icon: 'Code', command: () => editor.chain().focus().toggleCode().run(), isActive: 'code', title: 'Inline Code' },
                    { icon: '{ }', command: () => editor.chain().focus().toggleCodeBlock().run(), isActive: 'codeBlock', title: 'Code Block' }
                ],
                [
                    { icon: '🖼️', command: () => addImageToEditor(editor), isActive: null, title: 'Insert Image' }
                ]
            ];

            buttonGroups.forEach((group, groupIndex) => {
                group.forEach(btn => {
                    const button = document.createElement('button');
                    button.textContent = btn.icon;
                    button.title = btn.title;
                    button.type = 'button';
                    button.onclick = (e) => {
                        e.preventDefault();
                        btn.command();
                    };
                    
                    if (btn.isActive) {
                        const updateActiveState = () => {
                            if (editor.isActive(btn.isActive)) {
                                button.classList.add('is-active');
                            } else {
                                button.classList.remove('is-active');
                            }
                        };
                        
                        editor.on('selectionUpdate', updateActiveState);
                        editor.on('transaction', updateActiveState);
                    }
                    
                    container.appendChild(button);
                });
                
                // 그룹 구분선 (마지막 그룹 제외)
                if (groupIndex < buttonGroups.length - 1) {
                    const divider = document.createElement('div');
                    divider.className = 'w-px h-6 bg-gray-300 mx-1';
                    container.appendChild(divider);
                }
            });
        }

        // 이미지 추가 함수
        function addImageToEditor(editor) {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = 'image/*';
            input.onchange = async (e) => {
                const file = e.target.files[0];
                if (file) {
                    try {
                        console.log('📸 이미지 업로드 시작:', file.name);
                        
                        // 이미지 리사이즈
                        const resizedBlob = await resizeImage(file, 1200);
                        
                        // imgBB에 업로드
                        const imgbbKey = '4d755673211c39884cb2a812e1c698c7';
                        const formData = new FormData();
                        formData.append('image', resizedBlob);
                        
                        const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        const data = await response.json();
                        if (data.success) {
                            editor.chain().focus().setImage({ src: data.data.url }).run();
                            console.log('✅ 이미지 업로드 성공:', data.data.url);
                        } else {
                            console.error('❌ 이미지 업로드 실패:', data);
                            alert('이미지 업로드 실패');
                        }
                    } catch (error) {
                        console.error('❌ 이미지 업로드 오류:', error);
                        alert('이미지 업로드 중 오류가 발생했습니다: ' + error.message);
                    }
                }
            };
            input.click();
        }

        // 이미지 리사이즈 함수
        function resizeImage(file, maxWidth) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;

                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }

                        canvas.width = width;
                        canvas.height = height;
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);

                        canvas.toBlob((blob) => resolve(blob), file.type);
                    };
                    img.onerror = () => reject(new Error('이미지 로드 실패'));
                    img.src = e.target.result;
                };
                reader.onerror = () => reject(new Error('파일 읽기 실패'));
                reader.readAsDataURL(file);
            });
        }

        // isPinned 체크박스 이벤트
        document.getElementById('isPinned').addEventListener('change', function() {
            const pinnedTypeGroup = document.getElementById('pinnedTypeGroup');
            if (this.checked) {
                pinnedTypeGroup.classList.remove('hidden');
            } else {
                pinnedTypeGroup.classList.add('hidden');
            }
        });

        // 썸네일 미리보기
        document.getElementById('thumbnailImage').addEventListener('change', function(e) {
            const file = e.target.files[0];
            const preview = document.getElementById('thumbnailPreview');
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.innerHTML = `
                        <div class="relative inline-block">
                            <img src="${e.target.result}" alt="썸네일 미리보기" class="max-w-sm rounded-lg shadow-md border border-gray-200">
                            <div class="absolute top-2 right-2 bg-green-500 text-white text-xs px-2 py-1 rounded">미리보기</div>
                        </div>
                    `;
                };
                reader.readAsDataURL(file);
            } else {
                preview.innerHTML = '';
            }
        });

        // 한국어에서 가져오기 함수
        window.copyFromKorean = function(type) {
            if (type === 'title') {
                const titleKo = document.getElementById('titleKo').value;
                document.getElementById('titleEn').value = titleKo;
            } else if (type === 'description') {
                const descriptionKo = document.getElementById('descriptionKo').value;
                document.getElementById('descriptionEn').value = descriptionKo;
            } else if (type === 'content') {
                const contentKo = editorKo.getHTML();
                editorEn.commands.setContent(contentKo);
            }
        };

        // 폼 초기화
        window.resetForm = function() {
            if (confirm('모든 입력 내용을 초기화하시겠습니까?')) {
                document.getElementById('contentForm').reset();
                document.getElementById('thumbnailPreview').innerHTML = '';
                document.getElementById('pinnedTypeGroup').classList.add('hidden');
                editorKo.commands.clearContent();
                editorEn.commands.clearContent();
            }
        };

        // 폼 제출
        document.getElementById('contentForm').addEventListener('submit', async function(e) {
            e.preventDefault();

            const category = document.getElementById('category').value;
            const titleKo = document.getElementById('titleKo').value;
            const titleEn = document.getElementById('titleEn').value;
            const descriptionKo = document.getElementById('descriptionKo').value;
            const descriptionEn = document.getElementById('descriptionEn').value;
            const subcategory = document.getElementById('subcategory').value;
            const author = document.getElementById('author').value;
            const thumbnailFile = document.getElementById('thumbnailImage').files[0];
            const contentKoHtml = editorKo.getHTML();
            const contentEnHtml = editorEn.getHTML();

            // 유효성 검사
            if (!category || !titleKo || !titleEn || !descriptionKo || !descriptionEn || 
                !subcategory || !author || !thumbnailFile) {
                alert('필수 항목을 모두 입력해주세요.');
                return;
            }

            if (!contentKoHtml || contentKoHtml.trim() === '<p></p>' || contentKoHtml.trim() === '') {
                alert('한국어 본문 내용을 입력해주세요.');
                return;
            }

            if (!contentEnHtml || contentEnHtml.trim() === '<p></p>' || contentEnHtml.trim() === '') {
                alert('영어 본문 내용을 입력해주세요.');
                return;
            }

            try {
                console.log('📝 발행 프로세스 시작...');

                const isPinned = document.getElementById('isPinned').checked;
                const pinnedTypes = [];
                if (isPinned) {
                    document.querySelectorAll('input[name="pinnedType"]:checked').forEach(checkbox => {
                        pinnedTypes.push(checkbox.value);
                    });
                }

                const tagsInput = document.getElementById('tags').value;
                const tags = tagsInput ? tagsInput.split(',').map(tag => tag.trim()) : [];
                const relatedDistrict = document.getElementById('relatedDistrict').value;
                const culturalBadge = document.getElementById('culturalBadge').value;

                console.log('📤 썸네일 이미지 업로드 중...');
                
                const thumbnailBlob = await resizeImage(thumbnailFile, 1200);
                const imgbbKey = '4d755673211c39884cb2a812e1c698c7';
                const formData = new FormData();
                formData.append('image', thumbnailBlob);

                const response = await fetch(`https://api.imgbb.com/1/upload?key=${imgbbKey}`, {
                    method: 'POST',
                    body: formData
                });

                const data = await response.json();
                if (!data.success) {
                    throw new Error('썸네일 이미지 업로드 실패');
                }

                const thumbnailUrl = data.data.url;
                console.log('✅ 썸네일 업로드 성공');

                const timestamp = Date.now();
                const newId = `${category}_${timestamp}`;

                const newPost = {
                    id: newId,
                    titleKo: titleKo,
                    titleEn: titleEn,
                    descriptionKo: descriptionKo,
                    descriptionEn: descriptionEn,
                    subcategory: subcategory,
                    author: author,
                    date: new Date().toISOString().split('T')[0],
                    image: thumbnailUrl,
                    culturalBadge: culturalBadge || '',
                    tags: tags,
                    relatedDistrict: relatedDistrict || '',
                    isPinned: isPinned,
                    pinnedType: pinnedTypes,
                    contentKo: contentKoHtml,
                    contentEn: contentEnHtml
                };

                let targetData;
                if (category === 'fashion') targetData = [...fashionData];
                else if (category === 'beauty') targetData = [...beautyData];
                else if (category === 'life') targetData = [...lifeData];
                else if (category === 'districts') targetData = [...districtsData];

                targetData.push(newPost);

                console.log('💾 파일 생성 중...');
                
                // JSON 파일 다운로드
                const jsonBlob = new Blob([JSON.stringify(targetData, null, 2)], { type: 'application/json' });
                const jsonUrl = URL.createObjectURL(jsonBlob);
                const jsonLink = document.createElement('a');
                jsonLink.href = jsonUrl;
                jsonLink.download = `${category}.json`;
                jsonLink.click();

                // TXT 파일 다운로드
                const requestText = `카테고리: ${category}
ID: ${newId}
제목(한국어): ${titleKo}
제목(영어): ${titleEn}

등록을 요청합니다.`;
                const txtBlob = new Blob([requestText], { type: 'text/plain' });
                const txtUrl = URL.createObjectURL(txtBlob);
                const txtLink = document.createElement('a');
                txtLink.href = txtUrl;
                txtLink.download = `${category}_${newId}_request.txt`;
                txtLink.click();

                console.log('✅ 발행 완료!');
                alert('✅ 발행이 완료되었습니다! 파일이 다운로드됩니다.');
                
                setTimeout(() => {
                    URL.revokeObjectURL(jsonUrl);
                    URL.revokeObjectURL(txtUrl);
                }, 100);
                
                if (confirm('폼을 초기화하시겠습니까?')) {
                    resetForm();
                }
            } catch (error) {
                console.error('❌ 발행 오류:', error);
                alert('발행 중 오류가 발생했습니다: ' + error.message);
            }
        });

        // 페이지 로드 시 초기화
        window.addEventListener('DOMContentLoaded', () => {
            console.log('🎬 시스템 시작');
            loadJSONData();
        });
    </script>
</body>
</html>
