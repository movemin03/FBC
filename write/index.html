<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>FBC Content Editor</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@300;400;500;700;900&family=Noto+Serif+KR:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Noto Sans KR', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif !important;
        }
        .font-serif, .font-serif * {
            font-family: 'Noto Serif KR', Georgia, serif !important;
        }
        body {
            font-family: 'Noto Sans KR', sans-serif;
        }
        .header-container {
            display: grid;
            grid-template-columns: 1fr auto 1fr;
            align-items: center;
        }
        .header-left {
            justify-self: start;
        }
        .header-center {
            justify-self: center;
        }
        .header-right {
            justify-self: end;
        }
        .editor-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        .form-section {
            background: white;
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            padding: 24px;
            margin-bottom: 24px;
        }
        .form-label {
            display: block;
            font-weight: 600;
            margin-bottom: 8px;
            font-size: 14px;
        }
        .form-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            height: 42px;
        }
        .form-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 16px;
            margin-top: 8px;
        }
        .checkbox-item {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .checkbox-item input[type="checkbox"] {
            width: 18px;
            height: 18px;
            cursor: pointer;
        }
        .btn-primary {
            background: #000;
            color: white;
            padding: 12px 32px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
        }
        .btn-primary:hover {
            background: #333;
        }
        .btn-primary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        .btn-reset {
            background: #6b7280;
            color: white;
            padding: 12px 32px;
            border: none;
            border-radius: 4px;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            margin-right: 12px;
        }
        .btn-reset:hover {
            background: #4b5563;
        }
        .btn-secondary {
            background: #3b82f6;
            color: white;
            padding: 10px 16px;
            border: none;
            border-radius: 4px;
            font-weight: 500;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 13px;
            white-space: nowrap;
            height: 42px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .btn-secondary:hover {
            background: #2563eb;
        }
        .btn-secondary:disabled {
            background: #9ca3af;
            cursor: not-allowed;
        }
        #pinned-options {
            display: none;
            margin-top: 16px;
            padding: 16px;
            background: #f9fafb;
            border-radius: 4px;
        }
        .input-with-translate {
            display: flex;
            gap: 8px;
            align-items: stretch;
        }
        .input-with-translate input {
            flex: 1;
        }
        .input-with-translate button {
            flex-shrink: 0;
        }
        .translate-status {
            font-size: 12px;
            color: #6b7280;
            margin-top: 4px;
            min-height: 16px;
        }
        .user-type-selector {
            display: flex;
            gap: 12px;
            align-items: center;
            padding: 16px;
            background: #f3f4f6;
            border-radius: 8px;
            margin-bottom: 24px;
        }
        .user-type-btn {
            padding: 8px 20px;
            border: 2px solid #d1d5db;
            border-radius: 4px;
            background: white;
            cursor: pointer;
            font-weight: 500;
            transition: all 0.2s;
        }
        .user-type-btn.active {
            background: #000;
            color: white;
            border-color: #000;
        }
        .thumbnail-container {
            display: flex;
            gap: 8px;
            align-items: stretch;
            flex-wrap: wrap;
        }
        .thumbnail-input-wrapper {
            flex: 1;
            min-width: 200px;
            position: relative;
        }
        .thumbnail-input-wrapper input[type="file"] {
            display: none;
        }
        .thumbnail-fake-input {
            width: 100%;
            padding: 10px 40px 10px 12px;
            border: 1px solid #d1d5db;
            border-radius: 4px;
            font-size: 14px;
            height: 42px;
            background: white;
            cursor: pointer;
            display: flex;
            align-items: center;
            color: #9ca3af;
            position: relative;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        .thumbnail-fake-input.has-file {
            color: #000;
        }
        .thumbnail-clear-btn {
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #9ca3af;
            color: white;
            border: none;
            cursor: pointer;
            display: none;
            align-items: center;
            justify-content: center;
            font-size: 12px;
            line-height: 1;
        }
        .thumbnail-fake-input.has-file + .thumbnail-clear-btn {
            display: flex;
        }
        .thumbnail-preview {
            width: 100%;
            max-height: 200px;
            object-fit: contain;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            margin-top: 12px;
            display: none;
        }
        .thumbnail-preview.active {
            display: block;
        }
        .loading-spinner {
            display: none;
            text-align: center;
            padding: 20px;
            color: #6b7280;
        }
        .loading-spinner.active {
            display: block;
        }
        
        /* Upload Progress */
        .upload-progress {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.2);
            z-index: 9999;
            min-width: 300px;
            text-align: center;
        }
        .upload-progress.active {
            display: block;
        }
        .upload-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 9998;
        }
        .upload-overlay.active {
            display: block;
        }
        .progress-bar {
            width: 100%;
            height: 8px;
            background: #e5e7eb;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 15px;
        }
        .progress-fill {
            height: 100%;
            background: #3b82f6;
            transition: width 0.3s;
            width: 0%;
        }
        
        /* Tiptap Editor Styles */
        .tiptap-wrapper {
            border: 1px solid #e5e7eb;
            border-radius: 8px;
            overflow: hidden;
            background: white;
        }
        
        .tiptap-toolbar {
            border-bottom: 1px solid #e5e7eb;
            padding: 8px 12px;
            display: flex;
            gap: 4px;
            flex-wrap: wrap;
            background: #fafafa;
            align-items: center;
        }
        
        .tiptap-toolbar-group {
            display: flex;
            gap: 2px;
            align-items: center;
        }
        
        .tiptap-button {
            padding: 6px;
            border: none;
            border-radius: 4px;
            background: transparent;
            cursor: pointer;
            transition: all 0.15s;
            display: flex;
            align-items: center;
            justify-content: center;
            min-width: 36px;
            min-height: 36px;
            color: #374151;
        }
        
        .tiptap-button:hover {
            background: #e5e7eb;
        }
        
        .tiptap-button[data-active-state="on"],
        .tiptap-button[aria-pressed="true"] {
            background: #f3f4f6;
            color: #000;
        }
        
        .tiptap-button:disabled {
            opacity: 0.4;
            cursor: not-allowed;
        }
        
        .tiptap-button-icon {
            width: 20px;
            height: 20px;
        }
        
        .tiptap-button-text {
            font-size: 14px;
            font-weight: 500;
            margin-left: 4px;
        }
        
        .tiptap-separator {
            width: 1px;
            height: 24px;
            background: #e5e7eb;
            margin: 0 4px;
        }
        
        /* ProseMirror Base Styles */
        .ProseMirror {
            padding: 20px;
            min-height: 400px;
            outline: none;
            font-size: 16px;
            line-height: 1.6;
        }
        
        .ProseMirror p {
            margin: 0.75em 0;
        }
        
        .ProseMirror h1 {
            font-size: 2em;
            font-weight: bold;
            margin: 1em 0 0.5em;
            line-height: 1.2;
        }
        
        .ProseMirror h2 {
            font-size: 1.5em;
            font-weight: bold;
            margin: 0.8em 0 0.4em;
            line-height: 1.3;
        }
        
        .ProseMirror h3 {
            font-size: 1.25em;
            font-weight: bold;
            margin: 0.6em 0 0.3em;
            line-height: 1.4;
        }
        
        .ProseMirror strong {
            font-weight: bold;
        }
        
        .ProseMirror em {
            font-style: italic;
        }
        
        .ProseMirror code {
            background: #f3f4f6;
            padding: 2px 6px;
            border-radius: 3px;
            font-family: 'Courier New', monospace;
            font-size: 0.9em;
        }
        
        .ProseMirror pre {
            background: #1e293b;
            color: #e2e8f0;
            padding: 16px;
            border-radius: 6px;
            overflow-x: auto;
            margin: 1em 0;
        }
        
        .ProseMirror pre code {
            background: none;
            padding: 0;
            color: inherit;
        }
        
        .ProseMirror ul, .ProseMirror ol {
            padding-left: 2em;
            margin: 0.75em 0;
        }
        
        .ProseMirror ul {
            list-style-type: disc;
        }
        
        .ProseMirror ol {
            list-style-type: decimal;
        }
        
        .ProseMirror li {
            margin: 0.25em 0;
        }
        
        .ProseMirror blockquote {
            border-left: 4px solid #d1d5db;
            padding-left: 1em;
            margin: 1em 0;
            color: #6b7280;
            font-style: italic;
        }
        
        .ProseMirror hr {
            border: none;
            border-top: 2px solid #e5e7eb;
            margin: 2em 0;
        }
        
        .ProseMirror img {
            max-width: 600px;
            height: auto;
            border-radius: 4px;
            margin: 1em 0;
        }
        
        .ProseMirror a {
            color: #3b82f6;
            text-decoration: underline;
            cursor: pointer;
        }
        
        .ProseMirror a:hover {
            color: #2563eb;
        }
        
        .ProseMirror p.is-editor-empty:first-child::before {
            content: attr(data-placeholder);
            float: left;
            color: #9ca3af;
            pointer-events: none;
            height: 0;
        }
        
        .ProseMirror:focus {
            outline: none;
        }
        
        @media (max-width: 768px) {
            .thumbnail-container {
                flex-direction: column;
            }
            .thumbnail-input-wrapper {
                width: 100%;
            }
            .tiptap-toolbar {
                gap: 2px;
            }
            .tiptap-button {
                min-width: 32px;
                min-height: 32px;
                padding: 4px;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Upload Progress Modal -->
    <div class="upload-overlay" id="upload-overlay"></div>
    <div class="upload-progress" id="upload-progress">
        <h3 class="text-lg font-bold mb-2">ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘...</h3>
        <p id="upload-status" class="text-sm text-gray-600 mb-2">ì¤€ë¹„ ì¤‘...</p>
        <div class="progress-bar">
            <div class="progress-fill" id="progress-fill"></div>
        </div>
        <p id="upload-detail" class="text-xs text-gray-500 mt-2"></p>
    </div>

    <!-- Header -->
    <header class="bg-white border-b sticky top-0 z-50">
        <div class="max-w-7xl mx-auto px-4">
            <div class="header-container py-3 border-b">
                <div class="header-left flex items-center space-x-4 text-xs">
                    <button id="lang-toggle" class="px-3 py-1 border border-gray-300 hover:bg-gray-100 transition">
                        <span id="lang-text">í•œêµ­ì–´</span>
                    </button>
                </div>
                <div class="header-center">
                    <a href="../index.html" class="hover:opacity-80 transition">
                        <h1 class="text-3xl font-serif font-bold tracking-wider">FBC</h1>
                    </a>
                </div>
                <div class="header-right flex items-center space-x-4 text-xs">
                    <a href="#newsletter-section" class="hover:text-gray-600">SUBSCRIBE</a>
                </div>
            </div>
            <nav class="py-4">
                <ul class="flex items-center justify-center space-x-6 md:space-x-8 text-sm font-medium">
                    <li><a href="../fashion/index.html" class="hover:text-gray-600 transition">FASHION</a></li>
                    <li><a href="../beauty/index.html" class="hover:text-gray-600 transition">BEAUTY</a></li>
                    <li><a href="../life/index.html" class="hover:text-gray-600 transition">LIFE</a></li>
                    <li><a href="../districts/index.html" class="hover:text-gray-600 transition relative">DISTRICTS</a></li>
                </ul>
            </nav>
        </div>
    </header>

    <!-- Editor Container -->
    <div class="editor-container">
        <h1 class="text-3xl font-bold mb-8">ì½˜í…ì¸  ë°œí–‰ ì—ë””í„°</h1>

        <!-- Loading Spinner -->
        <div class="loading-spinner active" id="loading-spinner">
            <p>ğŸ“ JSON ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘...</p>
        </div>

        <div id="editor-content" style="display: none;">

        <!-- User Type Selection -->
        <div class="user-type-selector">
            <span class="font-semibold">ì‚¬ìš©ì:</span>
            <button class="user-type-btn" id="user-type-developer" onclick="setUserType('developer')">ê°œë°œì</button>
            <button class="user-type-btn active" id="user-type-general" onclick="setUserType('general')">ì¼ë°˜ì¸</button>
        </div>

        <!-- Category Selection -->
        <div class="form-section">
            <label class="form-label">ì¹´í…Œê³ ë¦¬ ì„ íƒ *</label>
            <select id="category" class="form-input" required>
                <option value="">-- ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•˜ì„¸ìš” --</option>
                <option value="fashion">Fashion</option>
                <option value="beauty">Beauty</option>
                <option value="life">Life</option>
                <option value="districts">Districts</option>
            </select>
        </div>

        <!-- Pinned Options -->
        <div class="form-section">
            <div class="checkbox-item">
                <input type="checkbox" id="is-pinned">
                <label for="is-pinned" class="form-label" style="margin: 0;">ë©”ì¸ í˜ì´ì§€ì— ê³ ì • (Pinned)</label>
            </div>
            
            <div id="pinned-options">
                <label class="form-label">Pinned íƒ€ì… ì„ íƒ (ë‹¤ì¤‘ ì„ íƒ ê°€ëŠ¥)</label>
                <div class="checkbox-group">
                    <div class="checkbox-item">
                        <input type="checkbox" id="pinned-hero" value="hero">
                        <label for="pinned-hero">Hero</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="pinned-todayStories" value="todayStories">
                        <label for="pinned-todayStories">Today's Stories</label>
                    </div>
                    <div class="checkbox-item">
                        <input type="checkbox" id="pinned-mustRead" value="mustRead">
                        <label for="pinned-mustRead">Must Read</label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Title Inputs -->
        <div class="form-section">
            <div class="mb-4">
                <label class="form-label">ì œëª© (í•œêµ­ì–´) *</label>
                <input type="text" id="title-kor" class="form-input" placeholder="í•œêµ­ì–´ ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            <div>
                <label class="form-label">ì œëª© (English) *</label>
                <div class="input-with-translate">
                    <input type="text" id="title-en" class="form-input" placeholder="Enter English title" required>
                    <button type="button" id="translate-title-btn" class="btn-secondary">ğŸŒ í•œêµ­ì–´ì—ì„œ ê°€ì ¸ì˜¤ê¸°</button>
                </div>
                <div id="translate-title-status" class="translate-status"></div>
            </div>
        </div>

        <!-- Description Inputs -->
        <div class="form-section">
            <div class="mb-4">
                <label class="form-label">ì„¤ëª… (í•œêµ­ì–´) *</label>
                <input type="text" id="desc-kor" class="form-input" placeholder="í•œêµ­ì–´ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”" required>
            </div>
            <div>
                <label class="form-label">ì„¤ëª… (English) *</label>
                <div class="input-with-translate">
                    <input type="text" id="desc-en" class="form-input" placeholder="Enter English description" required>
                    <button type="button" id="translate-desc-btn" class="btn-secondary">ğŸŒ í•œêµ­ì–´ì—ì„œ ê°€ì ¸ì˜¤ê¸°</button>
                </div>
                <div id="translate-desc-status" class="translate-status"></div>
            </div>
        </div>

        <!-- Additional Fields -->
        <div class="form-section">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="form-label">ì¹´í…Œê³ ë¦¬ ì„¸ë¶€ * (ì˜ì–´/ìˆ«ìë§Œ)</label>
                    <input type="text" id="subcategory" class="form-input" placeholder="ì˜ˆ: Fashion Item, Beauty Tip" pattern="[A-Za-z0-9\s]+" required>
                </div>
                <div>
                    <label class="form-label">ì‘ì„±ì * (ì˜ì–´/ìˆ«ìë§Œ)</label>
                    <input type="text" id="author" class="form-input" placeholder="Author name" pattern="[A-Za-z0-9\s\-]+" required>
                </div>
                <div class="md:col-span-2">
                    <label class="form-label">ì¸ë„¤ì¼ ì´ë¯¸ì§€ * (jpg, jpeg, pngë§Œ)</label>
                    <div class="thumbnail-container">
                        <div class="thumbnail-input-wrapper">
                            <input type="file" id="thumbnail-upload" accept=".jpg,.jpeg,.png">
                            <div class="thumbnail-fake-input" id="thumbnail-fake-input" onclick="document.getElementById('thumbnail-upload').click()">
                                ì´ë¯¸ì§€ ì„ íƒ...
                            </div>
                            <button type="button" class="thumbnail-clear-btn" id="thumbnail-clear-btn" onclick="clearThumbnail()">âœ•</button>
                        </div>
                    </div>
                    <img id="thumbnail-preview" class="thumbnail-preview" alt="ì¸ë„¤ì¼ ë¯¸ë¦¬ë³´ê¸°">
                </div>
                <div>
                    <label class="form-label">Cultural Badge (ì„ íƒ, ì˜ì–´/ìˆ«ìë§Œ)</label>
                    <input type="text" id="cultural-badge" class="form-input" placeholder="ì˜ˆ: Industrial Chic" pattern="[A-Za-z0-9\s]+">
                </div>
                <div>
                    <label class="form-label">íƒœê·¸ (ì‰¼í‘œë¡œ êµ¬ë¶„, ì˜ì–´/ìˆ«ìë§Œ)</label>
                    <input type="text" id="tags" class="form-input" placeholder="tag1, tag2, tag3" pattern="[A-Za-z0-9\s,]+">
                </div>
                <div>
                    <label class="form-label">ê´€ë ¨ ì§€ì—­ (ì„ íƒ)</label>
                    <select id="district-select" class="form-input">
                        <option value="">-- ì§€ì—­ì„ ì„ íƒí•˜ì„¸ìš” --</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Content Editor (Korean) -->
        <div class="form-section">
            <label class="form-label">ë³¸ë¬¸ ë‚´ìš© (í•œêµ­ì–´) *</label>
            <div class="tiptap-wrapper">
                <div class="tiptap-toolbar" id="toolbar-kor"></div>
                <div id="editor-kor"></div>
            </div>
        </div>

        <!-- Content Editor (English) -->
        <div class="form-section">
            <div class="flex justify-between items-center mb-2">
                <label class="form-label" style="margin: 0;">ë³¸ë¬¸ ë‚´ìš© (English) *</label>
                <button type="button" id="translate-content-btn" class="btn-secondary">ğŸŒ í•œêµ­ì–´ ë³¸ë¬¸ì—ì„œ ê°€ì ¸ì˜¤ê¸°</button>
            </div>
            <div id="translate-content-status" class="translate-status mb-2"></div>
            <div class="tiptap-wrapper">
                <div class="tiptap-toolbar" id="toolbar-en"></div>
                <div id="editor-en"></div>
            </div>
        </div>

        <!-- Publish Button -->
        <div class="form-section text-center">
            <button id="reset-btn" class="btn-reset">ì´ˆê¸°í™”</button>
            <button id="publish-btn" class="btn-primary">ë°œí–‰í•˜ê¸°</button>
            <p class="text-sm text-gray-600 mt-4" id="publish-info">ë°œí–‰í•˜ë©´ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ê³  ZIP íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.</p>
        </div>

        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-black text-white py-12">
        <div class="max-w-7xl mx-auto px-4">
            <div class="grid grid-cols-1 md:grid-cols-4 gap-8 mb-8">
                <div>
                    <h3 class="font-serif text-2xl font-bold mb-4">FBC</h3>
                    <p class="text-sm text-gray-400">Fashion, Beauty, Culture<br>with Cultural Translation</p>
                </div>
                <div>
                    <h4 class="font-bold mb-3 text-sm">CATEGORIES</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="../fashion/index.html" class="hover:text-white">Fashion</a></li>
                        <li><a href="../beauty/index.html" class="hover:text-white">Beauty</a></li>
                        <li><a href="../life/index.html" class="hover:text-white">Life & Culture</a></li>
                        <li><a href="../districts/index.html" class="hover:text-white">Districts</a></li>
                    </ul>
                </div>
                <div>
                    <h4 class="font-bold mb-3 text-sm">ABOUT</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><a href="../about/index.html" class="hover:text-white">About FBC</a></li>
                    </ul>
                </div>
                <div id="newsletter-section">
                    <h4 class="font-bold mb-3 text-sm">NEWSLETTER</h4>
                    <p class="text-sm text-gray-400 mb-3">Get weekly K-fashion insights</p>
                    <div class="flex">
                        <input type="email" id="newsletter-email" placeholder="Your email" class="px-3 py-2 bg-gray-800 text-sm flex-1 focus:outline-none">
                        <button id="newsletter-submit" class="px-4 py-2 bg-white text-black text-sm font-medium">â†’</button>
                    </div>
                </div>
            </div>
            <div class="border-t border-gray-800 pt-6 text-center text-xs text-gray-500">
                Â© 2025 FBC Creators. All rights reserved.
            </div>
        </div>
    </footer>

    <script type="module">
        import { Editor } from 'https://esm.sh/@tiptap/core@2.10.3'
        import StarterKit from 'https://esm.sh/@tiptap/starter-kit@2.10.3'
        import Image from 'https://esm.sh/@tiptap/extension-image@2.10.3'
        import Link from 'https://esm.sh/@tiptap/extension-link@2.10.3'
        import Underline from 'https://esm.sh/@tiptap/extension-underline@2.10.3'
        import TextAlign from 'https://esm.sh/@tiptap/extension-text-align@2.10.3'
        import Placeholder from 'https://esm.sh/@tiptap/extension-placeholder@2.10.3'
        import Highlight from 'https://esm.sh/@tiptap/extension-highlight@2.10.3'
        import { Markdown } from 'https://esm.sh/tiptap-markdown@0.8.10'

        // ImgBB API Key
        const IMGBB_API_KEY = '4a0d69744fa47d8de59028ec369b7abc';

        // Store uploaded JSON data
        let uploadedData = {
            fashion: [],
            beauty: [],
            life: [],
            districts: [],
            article: [],
            pinned: { hero: [], todayStories: [], mustRead: [] }
        };

        // Store thumbnail file
        let thumbnailFile = null;
        let userType = 'general';

        // Store editors
        let editorKor = null;
        let editorEn = null;

        // District Meta Data
        const districtMeta = [
            { "district_id": "dsm00001", "name_kor": "ì„±ìˆ˜ë™", "name_en": "Seongsu-dong" },
            { "district_id": "dsm00002", "name_kor": "í•œë‚¨ë™", "name_en": "Hannam-dong" },
            { "district_id": "dsm00003", "name_kor": "í™ëŒ€", "name_en": "Hongdae" },
            { "district_id": "dsm00004", "name_kor": "ëª…ë™", "name_en": "Myeongdong" }
        ];

        // SVG Icons
        const icons = {
            bold: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M6 2.5C5.17157 2.5 4.5 3.17157 4.5 4V20C4.5 20.8284 5.17157 21.5 6 21.5H15C16.4587 21.5 17.8576 20.9205 18.8891 19.8891C19.9205 18.8576 20.5 17.4587 20.5 16C20.5 14.5413 19.9205 13.1424 18.8891 12.1109C18.6781 11.9 18.4518 11.7079 18.2128 11.5359C19.041 10.5492 19.5 9.29829 19.5 8C19.5 6.54131 18.9205 5.14236 17.8891 4.11091C16.8576 3.07946 15.4587 2.5 14 2.5H6ZM14 10.5C14.663 10.5 15.2989 10.2366 15.7678 9.76777C16.2366 9.29893 16.5 8.66304 16.5 8C16.5 7.33696 16.2366 6.70107 15.7678 6.23223C15.2989 5.76339 14.663 5.5 14 5.5H7.5V10.5H14ZM7.5 18.5V13.5H15C15.663 13.5 16.2989 13.7634 16.7678 14.2322C17.2366 14.7011 17.5 15.337 17.5 16C17.5 16.663 17.2366 17.2989 16.7678 17.7678C16.2989 18.2366 15.663 18.5 15 18.5H7.5Z" fill="currentColor"></path></svg>',
            italic: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.0222 3H19C19.5523 3 20 3.44772 20 4C20 4.55228 19.5523 5 19 5H15.693L10.443 19H14C14.5523 19 15 19.4477 15 20C15 20.5523 14.5523 21 14 21H9.02418C9.00802 21.0004 8.99181 21.0004 8.97557 21H5C4.44772 21 4 20.5523 4 20C4 19.4477 4.44772 19 5 19H8.30704L13.557 5H10C9.44772 5 9 4.55228 9 4C9 3.44772 9.44772 3 10 3H14.9782C14.9928 2.99968 15.0075 2.99967 15.0222 3Z" fill="currentColor"></path></svg>',
            strike: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M9.00039 3H16.0001C16.5524 3 17.0001 3.44772 17.0001 4C17.0001 4.55229 16.5524 5 16.0001 5H9.00011C8.68006 4.99983 8.36412 5.07648 8.07983 5.22349C7.79555 5.37051 7.55069 5.5836 7.36585 5.84487C7.181 6.10614 7.06155 6.40796 7.01754 6.72497C6.97352 7.04198 7.00623 7.36492 7.11292 7.66667C7.29701 8.18737 7.02414 8.75872 6.50344 8.94281C5.98274 9.1269 5.4114 8.85403 5.2273 8.33333C5.01393 7.72984 4.94851 7.08396 5.03654 6.44994C5.12456 5.81592 5.36346 5.21229 5.73316 4.68974C6.10285 4.1672 6.59256 3.74101 7.16113 3.44698C7.72955 3.15303 8.36047 2.99975 9.00039 3Z" fill="currentColor"></path><path d="M18 13H20C20.5523 13 21 12.5523 21 12C21 11.4477 20.5523 11 20 11H4C3.44772 11 3 11.4477 3 12C3 12.5523 3.44772 13 4 13H14C14.7956 13 15.5587 13.3161 16.1213 13.8787C16.6839 14.4413 17 15.2044 17 16C17 16.7956 16.6839 17.5587 16.1213 18.1213C15.5587 18.6839 14.7956 19 14 19H6C5.44772 19 5 19.4477 5 20C5 20.5523 5.44772 21 6 21H14C15.3261 21 16.5979 20.4732 17.5355 19.5355C18.4732 18.5979 19 17.3261 19 16C19 14.9119 18.6453 13.8604 18 13Z" fill="currentColor"></path></svg>',
            code: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M15.4545 4.2983C15.6192 3.77115 15.3254 3.21028 14.7983 3.04554C14.2712 2.88081 13.7103 3.1746 13.5455 3.70175L8.54554 19.7017C8.38081 20.2289 8.6746 20.7898 9.20175 20.9545C9.72889 21.1192 10.2898 20.8254 10.4545 20.2983L15.4545 4.2983Z" fill="currentColor"></path><path d="M6.70711 7.29289C7.09763 7.68342 7.09763 8.31658 6.70711 8.70711L3.41421 12L6.70711 15.2929C7.09763 15.6834 7.09763 16.3166 6.70711 16.7071C6.31658 17.0976 5.68342 17.0976 5.29289 16.7071L1.29289 12.7071C0.902369 12.3166 0.902369 11.6834 1.29289 11.2929L5.29289 7.29289C5.68342 6.90237 6.31658 6.90237 6.70711 7.29289Z" fill="currentColor"></path><path d="M17.2929 7.29289C17.6834 6.90237 18.3166 6.90237 18.7071 7.29289L22.7071 11.2929C23.0976 11.6834 23.0976 12.3166 22.7071 12.7071L18.7071 16.7071C18.3166 17.0976 17.6834 17.0976 17.2929 16.7071C16.9024 16.3166 16.9024 15.6834 17.2929 15.2929L20.5858 12L17.2929 8.70711C16.9024 8.31658 16.9024 7.68342 17.2929 7.29289Z" fill="currentColor"></path></svg>',
            highlight: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M14.7072 4.70711C15.0977 4.31658 15.0977 3.68342 14.7072 3.29289C14.3167 2.90237 13.6835 2.90237 13.293 3.29289L8.69294 7.89286L8.68594 7.9C8.13626 8.46079 7.82837 9.21474 7.82837 10C7.82837 10.2306 7.85491 10.4584 7.90631 10.6795L2.29289 16.2929C2.10536 16.4804 2 16.7348 2 17V20C2 20.5523 2.44772 21 3 21H12C12.2652 21 12.5196 20.8946 12.7071 20.7071L15.3205 18.0937C15.5416 18.1452 15.7695 18.1717 16.0001 18.1717C16.7853 18.1717 17.5393 17.8639 18.1001 17.3142L22.7072 12.7071C23.0977 12.3166 23.0977 11.6834 22.7072 11.2929C22.3167 10.9024 21.6835 10.9024 21.293 11.2929L16.6971 15.8887C16.5105 16.0702 16.2605 16.1717 16.0001 16.1717C15.7397 16.1717 15.4897 16.0702 15.303 15.8887L10.1113 10.697C9.92992 10.5104 9.82837 10.2604 9.82837 10C9.82837 9.73963 9.92992 9.48958 10.1113 9.30297L14.7072 4.70711ZM13.5858 17L9.00004 12.4142L4 17.4142V19H11.5858L13.5858 17Z" fill="currentColor"></path></svg>',
            link: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path d="M16.9958 1.06669C15.4226 1.05302 13.907 1.65779 12.7753 2.75074L12.765 2.76086L11.045 4.47086C10.6534 4.86024 10.6515 5.49341 11.0409 5.88507C11.4303 6.27673 12.0634 6.27858 12.4551 5.88919L14.1697 4.18456C14.9236 3.45893 15.9319 3.05752 16.9784 3.06662C18.0272 3.07573 19.0304 3.49641 19.772 4.23804C20.5137 4.97967 20.9344 5.98292 20.9435 7.03171C20.9526 8.07776 20.5515 9.08563 19.8265 9.83941L16.833 12.8329C16.4274 13.2386 15.9393 13.5524 15.4019 13.7529C14.8645 13.9533 14.2903 14.0359 13.7181 13.9949C13.146 13.9539 12.5894 13.7904 12.0861 13.5154C11.5827 13.2404 11.1444 12.8604 10.8008 12.401C10.47 11.9588 9.84333 11.8685 9.40108 12.1993C8.95883 12.5301 8.86849 13.1568 9.1993 13.599C9.71464 14.288 10.3721 14.858 11.1272 15.2705C11.8822 15.683 12.7171 15.9283 13.5753 15.9898C14.4334 16.0513 15.2948 15.9274 16.1009 15.6267C16.907 15.326 17.639 14.8555 18.2473 14.247L21.2472 11.2471L21.2593 11.2347C22.3523 10.1031 22.9571 8.58751 22.9434 7.01433C22.9297 5.44115 22.2987 3.93628 21.1863 2.82383C20.0738 1.71138 18.5689 1.08036 16.9958 1.06669Z" fill="currentColor"></path><path d="M10.4247 8.0102C9.56657 7.94874 8.70522 8.07256 7.89911 8.37326C7.09305 8.67395 6.36096 9.14458 5.75272 9.753L2.75285 12.7529L2.74067 12.7653C1.64772 13.8969 1.04295 15.4125 1.05662 16.9857C1.07029 18.5589 1.70131 20.0637 2.81376 21.1762C3.9262 22.2886 5.43108 22.9196 7.00426 22.9333C8.57744 22.947 10.0931 22.3422 11.2247 21.2493L11.2371 21.2371L12.9471 19.5271C13.3376 19.1366 13.3376 18.5034 12.9471 18.1129C12.5565 17.7223 11.9234 17.7223 11.5328 18.1129L9.82932 19.8164C9.07555 20.5414 8.06768 20.9425 7.02164 20.9334C5.97285 20.9243 4.9696 20.5036 4.22797 19.762C3.48634 19.0203 3.06566 18.0171 3.05655 16.9683C3.04746 15.9222 3.44851 14.9144 4.17355 14.1606L7.16719 11.167C7.5727 10.7613 8.06071 10.4476 8.59811 10.2471C9.13552 10.0467 9.70976 9.96412 10.2819 10.0051C10.854 10.0461 11.4106 10.2096 11.9139 10.4846C12.4173 10.7596 12.8556 11.1397 13.1992 11.599C13.53 12.0412 14.1567 12.1316 14.5989 11.8007C15.0412 11.4699 15.1315 10.8433 14.8007 10.401C14.2854 9.71205 13.6279 9.14198 12.8729 8.72948C12.1178 8.31697 11.2829 8.07166 10.4247 8.0102Z" fill="currentColor"></path></svg>',
            alignLeft: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2 12C2 11.4477 2.44772 11 3 11H15C15.5523 11 16 11.4477 16 12C16 12.5523 15.5523 13 15 13H3C2.44772 13 2 12.5523 2 12Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M2 18C2 17.4477 2.44772 17 3 17H17C17.5523 17 18 17.4477 18 18C18 18.5523 17.5523 19 17 19H3C2.44772 19 2 18.5523 2 18Z" fill="currentColor"></path></svg>',
            alignCenter: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M6 12C6 11.4477 6.44772 11 7 11H17C17.5523 11 18 11.4477 18 12C18 12.5523 17.5523 13 17 13H7C6.44772 13 6 12.5523 6 12Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M4 18C4 17.4477 4.44772 17 5 17H19C19.5523 17 20 17.4477 20 18C20 18.5523 19.5523 19 19 19H5C4.44772 19 4 18.5523 4 18Z" fill="currentColor"></path></svg>',
            alignRight: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M2 6C2 5.44772 2.44772 5 3 5H21C21.5523 5 22 5.44772 22 6C22 6.55228 21.5523 7 21 7H3C2.44772 7 2 6.55228 2 6Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M8 12C8 11.4477 8.44772 11 9 11H21C21.5523 11 22 11.4477 22 12C22 12.5523 21.5523 13 21 13H9C8.44772 13 8 12.5523 8 12Z" fill="currentColor"></path><path fill-rule="evenodd" clip-rule="evenodd" d="M6 18C6 17.4477 6.44772 17 7 17H21C21.5523 17 22 17.4477 22 18C22 18.5523 21.5523 19 21 19H7C6.44772 19 6 18.5523 6 18Z" fill="currentColor"></path></svg>',
            image: '<svg width="24" height="24" viewBox="0 0 24 24" fill="currentColor" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" clip-rule="evenodd" d="M20 2C20 1.44772 19.5523 1 19 1C18.4477 1 18 1.44772 18 2V4H16C15.4477 4 15 4.44772 15 5C15 5.55228 15.4477 6 16 6H18V8C18 8.55228 18.4477 9 19 9C19.5523 9 20 8.55228 20 8V6H22C22.5523 6 23 5.55228 23 5C23 4.44772 22.5523 4 22 4H20V2ZM5 4C4.73478 4 4.48043 4.10536 4.29289 4.29289C4.10536 4.48043 4 4.73478 4 5V19C4 19.2652 4.10536 19.5196 4.29289 19.7071C4.48043 19.8946 4.73478 20 5 20H5.58579L14.379 11.2068C14.9416 10.6444 15.7045 10.3284 16.5 10.3284C17.2955 10.3284 18.0584 10.6444 18.621 11.2068L20 12.5858V12C20 11.4477 20.4477 11 21 11C21.5523 11 22 11.4477 22 12V14.998C22 14.9994 22 15.0007 22 15.002V19C22 19.7957 21.6839 20.5587 21.1213 21.1213C20.5587 21.6839 19.7957 22 19 22H6.00219C6.00073 22 5.99927 22 5.99781 22H5C4.20435 22 3.44129 21.6839 2.87868 21.1213C2.31607 20.5587 2 19.7957 2 19V5C2 4.20435 2.31607 3.44129 2.87868 2.87868C3.44129 2.31607 4.20435 2 5 2H12C12.5523 2 13 2.44772 13 3C13 3.55228 12.5523 4 12 4H5ZM8.41422 20H19C19.2652 20 19.5196 19.8946 19.7071 19.7071C19.8946 19.5196 20 19.2652 20 19V15.4142L17.207 12.6212C17.0195 12.4338 16.7651 12.3284 16.5 12.3284C16.2349 12.3284 15.9806 12.4337 15.7931 12.6211L8.41422 20ZM6.87868 6.87868C7.44129 6.31607 8.20435 6 9 6C9.79565 6 10.5587 6.31607 11.1213 6.87868C11.6839 7.44129 12 8.20435 12 9C12 9.79565 11.6839 10.5587 11.1213 11.1213C10.5587 11.6839 9.79565 12 9 12C8.20435 12 7.44129 11.6839 6.87868 11.1213C6.31607 10.5587 6 9.79565 6 9C6 8.20435 6.31607 7.44129 6.87868 6.87868ZM9 8C8.73478 8 8.48043 8.10536 8.29289 8.29289C8.10536 8.48043 8 8.73478 8 9C8 9.26522 8.10536 9.51957 8.29289 9.70711C8.48043 9.89464 8.73478 10 9 10C9.26522 10 9.51957 9.89464 9.70711 9.70711C9.89464 9.51957 10 9.26522 10 9C10 8.73478 9.89464 8.48043 9.70711 8.29289C9.51957 8.10536 9.26522 8 9 8Z" fill="currentColor"></path></svg>',
        };

        // Image Resizing Function
        async function resizeImage(file, maxWidth = 600) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = (e) => {
                    const img = new Image();
                    img.onload = () => {
                        const canvas = document.createElement('canvas');
                        let width = img.width;
                        let height = img.height;
                        
                        if (width > maxWidth) {
                            height = (height * maxWidth) / width;
                            width = maxWidth;
                        }
                        
                        canvas.width = width;
                        canvas.height = height;
                        
                        const ctx = canvas.getContext('2d');
                        ctx.drawImage(img, 0, 0, width, height);
                        
                        canvas.toBlob((blob) => {
                            resolve(blob);
                        }, file.type || 'image/jpeg', 0.9);
                    };
                    img.onerror = reject;
                    img.src = e.target.result;
                };
                reader.onerror = reject;
                reader.readAsDataURL(file);
            });
        }

        // Upload to ImgBB
        async function uploadToImgBB(imageBlob) {
            return new Promise((resolve, reject) => {
                const reader = new FileReader();
                reader.onload = async () => {
                    try {
                        const base64 = reader.result.split(',')[1];
                        const formData = new FormData();
                        formData.append('image', base64);
                        
                        const response = await fetch(`https://api.imgbb.com/1/upload?key=${IMGBB_API_KEY}`, {
                            method: 'POST',
                            body: formData
                        });
                        
                        if (!response.ok) {
                            throw new Error('ImgBB upload failed');
                        }
                        
                        const data = await response.json();
                        if (data.success) {
                            resolve(data.data.url);
                        } else {
                            reject(new Error('ImgBB upload failed'));
                        }
                    } catch (error) {
                        reject(error);
                    }
                };
                reader.onerror = reject;
                reader.readAsDataURL(imageBlob);
            });
        }

        // Show/Hide Upload Progress
        function showUploadProgress(show = true) {
            document.getElementById('upload-overlay').classList.toggle('active', show);
            document.getElementById('upload-progress').classList.toggle('active', show);
        }

        function updateUploadProgress(percent, status, detail = '') {
            document.getElementById('progress-fill').style.width = `${percent}%`;
            document.getElementById('upload-status').textContent = status;
            document.getElementById('upload-detail').textContent = detail;
        }

        // Extract Base64 Images from HTML
        function extractBase64Images(html) {
            const imgRegex = /<img[^>]+src="(data:image\/[^;]+;base64[^"]+)"[^>]*>/g;
            const images = [];
            let match;
            
            while ((match = imgRegex.exec(html)) !== null) {
                images.push(match[1]);
            }
            
            return images;
        }

        // Replace Base64 with URLs in HTML
        function replaceBase64WithUrls(html, imageMap) {
            let result = html;
            imageMap.forEach((url, base64) => {
                result = result.split(base64).join(url);
            });
            return result;
        }

        // Convert Base64 to Blob
        function base64ToBlob(base64) {
            const parts = base64.split(';base64,');
            const contentType = parts[0].split(':')[1];
            const raw = window.atob(parts[1]);
            const rawLength = raw.length;
            const uInt8Array = new Uint8Array(rawLength);
            
            for (let i = 0; i < rawLength; ++i) {
                uInt8Array[i] = raw.charCodeAt(i);
            }
            
            return new Blob([uInt8Array], { type: contentType });
        }

        // Set User Type
        window.setUserType = function(type) {
            userType = type;
            document.getElementById('user-type-developer').classList.toggle('active', type === 'developer');
            document.getElementById('user-type-general').classList.toggle('active', type === 'general');
            
            const publishInfo = document.getElementById('publish-info');
            publishInfo.textContent = 'ë°œí–‰í•˜ë©´ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ê³  ZIP íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë©ë‹ˆë‹¤.';
        }

        // Populate District Dropdown
        const districtSelect = document.getElementById('district-select');
        districtMeta.forEach(district => {
            const option = document.createElement('option');
            option.value = district.district_id;
            option.textContent = district.name_kor;
            districtSelect.appendChild(option);
        });

        // Create toolbar buttons with modern design
        function createToolbar(editor, toolbarId) {
            const toolbar = document.getElementById(toolbarId);
            
            // Group 1: Text formatting
            const group1 = document.createElement('div');
            group1.className = 'tiptap-toolbar-group';
            
            const formatButtons = [
                { name: 'Bold', icon: icons.bold, command: () => editor.chain().focus().toggleBold().run(), isActive: () => editor.isActive('bold') },
                { name: 'Italic', icon: icons.italic, command: () => editor.chain().focus().toggleItalic().run(), isActive: () => editor.isActive('italic') },
                { name: 'Strike', icon: icons.strike, command: () => editor.chain().focus().toggleStrike().run(), isActive: () => editor.isActive('strike') },
                { name: 'Code', icon: icons.code, command: () => editor.chain().focus().toggleCode().run(), isActive: () => editor.isActive('code') },
            ];
            
            formatButtons.forEach(btn => {
                const button = document.createElement('button');
                button.className = 'tiptap-button';
                button.innerHTML = btn.icon;
                button.title = btn.name;
                button.type = 'button';
                button.setAttribute('aria-label', btn.name);
                button.onclick = btn.command;
                
                if (btn.isActive) {
                    const updateState = () => {
                        if (btn.isActive()) {
                            button.setAttribute('data-active-state', 'on');
                            button.setAttribute('aria-pressed', 'true');
                        } else {
                            button.setAttribute('data-active-state', 'off');
                            button.setAttribute('aria-pressed', 'false');
                        }
                    };
                    
                    editor.on('selectionUpdate', updateState);
                    editor.on('update', updateState);
                    updateState();
                }
                
                group1.appendChild(button);
            });
            
            toolbar.appendChild(group1);
            
            // Highlight button
            const highlightBtn = document.createElement('button');
            highlightBtn.className = 'tiptap-button';
            highlightBtn.innerHTML = icons.highlight;
            highlightBtn.title = 'Highlight text';
            highlightBtn.type = 'button';
            highlightBtn.setAttribute('aria-label', 'Highlight text');
            highlightBtn.onclick = () => editor.chain().focus().toggleHighlight().run();
            
            const updateHighlightState = () => {
                if (editor.isActive('highlight')) {
                    highlightBtn.setAttribute('data-active-state', 'on');
                    highlightBtn.setAttribute('aria-pressed', 'true');
                } else {
                    highlightBtn.setAttribute('data-active-state', 'off');
                    highlightBtn.setAttribute('aria-pressed', 'false');
                }
            };
            
            editor.on('selectionUpdate', updateHighlightState);
            editor.on('update', updateHighlightState);
            updateHighlightState();
            
            toolbar.appendChild(highlightBtn);
            
            // Link button
            const linkBtn = document.createElement('button');
            linkBtn.className = 'tiptap-button';
            linkBtn.innerHTML = icons.link;
            linkBtn.title = 'Link';
            linkBtn.type = 'button';
            linkBtn.setAttribute('aria-label', 'Link');
            linkBtn.onclick = () => {
                const url = window.prompt('URLì„ ì…ë ¥í•˜ì„¸ìš”:');
                if (url) {
                    editor.chain().focus().setLink({ href: url }).run();
                }
            };
            
            toolbar.appendChild(linkBtn);
            
            // Separator
            const sep1 = document.createElement('div');
            sep1.className = 'tiptap-separator';
            toolbar.appendChild(sep1);
            
            // Group 2: Alignment
            const group2 = document.createElement('div');
            group2.className = 'tiptap-toolbar-group';
            
            const alignButtons = [
                { name: 'Align left', icon: icons.alignLeft, command: () => editor.chain().focus().setTextAlign('left').run(), isActive: () => editor.isActive({ textAlign: 'left' }) },
                { name: 'Align center', icon: icons.alignCenter, command: () => editor.chain().focus().setTextAlign('center').run(), isActive: () => editor.isActive({ textAlign: 'center' }) },
                { name: 'Align right', icon: icons.alignRight, command: () => editor.chain().focus().setTextAlign('right').run(), isActive: () => editor.isActive({ textAlign: 'right' }) },
            ];
            
            alignButtons.forEach(btn => {
                const button = document.createElement('button');
                button.className = 'tiptap-button';
                button.innerHTML = btn.icon;
                button.title = btn.name;
                button.type = 'button';
                button.setAttribute('aria-label', btn.name);
                button.onclick = btn.command;
                
                if (btn.isActive) {
                    const updateState = () => {
                        if (btn.isActive()) {
                            button.setAttribute('data-active-state', 'on');
                            button.setAttribute('aria-pressed', 'true');
                        } else {
                            button.setAttribute('data-active-state', 'off');
                            button.setAttribute('aria-pressed', 'false');
                        }
                    };
                    
                    editor.on('selectionUpdate', updateState);
                    editor.on('update', updateState);
                    updateState();
                }
                
                group2.appendChild(button);
            });
            
            toolbar.appendChild(group2);
            
            // Separator
            const sep2 = document.createElement('div');
            sep2.className = 'tiptap-separator';
            toolbar.appendChild(sep2);
            
            // Group 3: Image
            const group3 = document.createElement('div');
            group3.className = 'tiptap-toolbar-group';
            
            const imageBtn = document.createElement('button');
            imageBtn.className = 'tiptap-button';
            imageBtn.innerHTML = icons.image + '<span class="tiptap-button-text">Add</span>';
            imageBtn.title = 'Add image';
            imageBtn.type = 'button';
            imageBtn.setAttribute('aria-label', 'Add image');
            imageBtn.onclick = async () => {
                const input = document.createElement('input');
                input.type = 'file';
                input.accept = 'image/*';
                input.onchange = async (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        try {
                            // Resize image to 600px width
                            const resizedBlob = await resizeImage(file, 600);
                            
                            // Convert to base64 for editor
                            const reader = new FileReader();
                            reader.onload = (e) => {
                                editor.chain().focus().setImage({ src: e.target.result }).run();
                            };
                            reader.readAsDataURL(resizedBlob);
                        } catch (error) {
                            console.error('Image resize error:', error);
                            alert('ì´ë¯¸ì§€ ì²˜ë¦¬ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.');
                        }
                    }
                };
                input.click();
            };
            
            group3.appendChild(imageBtn);
            toolbar.appendChild(group3);
        }

        // Initialize Tiptap Editors
        function initializeEditors() {
            // Korean Editor
            editorKor = new Editor({
                element: document.querySelector('#editor-kor'),
                extensions: [
                    StarterKit,
                    Markdown.configure({
                        html: true,
                        tightLists: true,
                        bulletListMarker: '-',
                        linkify: true,
                        breaks: false,
                    }),
                    Image.configure({
                        inline: false,
                        allowBase64: true,
                    }),
                    Link.configure({
                        openOnClick: false,
                        HTMLAttributes: {
                            target: '_blank',
                            rel: 'noopener noreferrer',
                        },
                    }),
                    Underline,
                    Highlight.configure({
                        multicolor: false,
                    }),
                    TextAlign.configure({
                        types: ['heading', 'paragraph'],
                    }),
                    Placeholder.configure({
                        placeholder: 'í•œêµ­ì–´ ë³¸ë¬¸ì„ ì…ë ¥í•˜ì„¸ìš”. ë§ˆí¬ë‹¤ìš´ì„ ì§€ì›í•©ë‹ˆë‹¤...',
                    }),
                ],
                content: '',
                editorProps: {
                    attributes: {
                        class: 'ProseMirror',
                    },
                },
            });

            // English Editor
            editorEn = new Editor({
                element: document.querySelector('#editor-en'),
                extensions: [
                    StarterKit,
                    Markdown.configure({
                        html: true,
                        tightLists: true,
                        bulletListMarker: '-',
                        linkify: true,
                        breaks: false,
                    }),
                    Image.configure({
                        inline: false,
                        allowBase64: true,
                    }),
                    Link.configure({
                        openOnClick: false,
                        HTMLAttributes: {
                            target: '_blank',
                            rel: 'noopener noreferrer',
                        },
                    }),
                    Underline,
                    Highlight.configure({
                        multicolor: false,
                    }),
                    TextAlign.configure({
                        types: ['heading', 'paragraph'],
                    }),
                    Placeholder.configure({
                        placeholder: 'Enter English content. Markdown is supported...',
                    }),
                ],
                content: '',
                editorProps: {
                    attributes: {
                        class: 'ProseMirror',
                    },
                },
            });

            // Create toolbars
            createToolbar(editorKor, 'toolbar-kor');
            createToolbar(editorEn, 'toolbar-en');
        }

        // Load JSON files from server
        async function loadJSONFromServer() {
            const files = {
                'fashion': '../data/fashion.json',
                'beauty': '../data/beauty.json',
                'life': '../data/life.json',
                'districts': '../data/districts.json',
                'article': '../data/article.json',
                'pinned': '../data/pinned.json'
            };
            
            let loadedCount = 0;
            
            for (const [key, path] of Object.entries(files)) {
                try {
                    const response = await fetch(path);
                    if (response.ok) {
                        const data = await response.json();
                        uploadedData[key] = data;
                        loadedCount++;
                    }
                } catch (error) {
                    console.warn(`${key}.json ë¡œë”© ì‹¤íŒ¨:`, error);
                    if (key === 'pinned') {
                        uploadedData[key] = { hero: [], todayStories: [], mustRead: [] };
                    } else {
                        uploadedData[key] = [];
                    }
                    loadedCount++;
                }
            }
            
            document.getElementById('loading-spinner').classList.remove('active');
            document.getElementById('editor-content').style.display = 'block';
            
            // Initialize editors after content is visible
            initializeEditors();
            
            console.log(`JSON ë¡œë”© ì™„ë£Œ: ${loadedCount}/6 íŒŒì¼`);
        }

        // Start loading
        loadJSONFromServer();

        // Clear Thumbnail
        window.clearThumbnail = function() {
            thumbnailFile = null;
            document.getElementById('thumbnail-upload').value = '';
            document.getElementById('thumbnail-fake-input').textContent = 'ì´ë¯¸ì§€ ì„ íƒ...';
            document.getElementById('thumbnail-fake-input').classList.remove('has-file');
            document.getElementById('thumbnail-preview').classList.remove('active');
        }

        // Thumbnail Upload Handler
        const thumbnailInput = document.getElementById('thumbnail-upload');
        const thumbnailFakeInput = document.getElementById('thumbnail-fake-input');
        const thumbnailPreview = document.getElementById('thumbnail-preview');

        thumbnailInput.addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const validTypes = ['image/jpeg', 'image/jpg', 'image/png'];
                if (!validTypes.includes(file.type)) {
                    alert('jpg, jpeg, png íŒŒì¼ë§Œ ì—…ë¡œë“œ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
                    this.value = '';
                    return;
                }

                thumbnailFile = file;
                thumbnailFakeInput.textContent = file.name;
                thumbnailFakeInput.classList.add('has-file');

                const reader = new FileReader();
                reader.onload = function(e) {
                    thumbnailPreview.src = e.target.result;
                    thumbnailPreview.classList.add('active');
                };
                reader.readAsDataURL(file);
            }
        });

        // Input Validation for English/Numbers only
        const englishOnlyFields = ['subcategory', 'author', 'cultural-badge', 'tags'];
        englishOnlyFields.forEach(fieldId => {
            const field = document.getElementById(fieldId);
            if (field) {
                field.addEventListener('input', function(e) {
                    const cursorPosition = this.selectionStart;
                    const originalLength = this.value.length;
                    this.value = this.value.replace(/[^A-Za-z0-9\s,\-]/g, '');
                    const newLength = this.value.length;
                    if (newLength < originalLength) {
                        this.setSelectionRange(cursorPosition - (originalLength - newLength), cursorPosition - (originalLength - newLength));
                    }
                });
            }
        });

        // Reset Button
        document.getElementById('reset-btn').addEventListener('click', function() {
            location.reload();
        });

        // MyMemory Translation API
        async function translateText(text, sourceLang = 'ko', targetLang = 'en') {
            if (!text || text.trim() === '') {
                throw new Error('ë²ˆì—­í•  í…ìŠ¤íŠ¸ê°€ ì—†ìŠµë‹ˆë‹¤.');
            }
            try {
                const url = `https://api.mymemory.translated.net/get?q=${encodeURIComponent(text)}&langpair=${sourceLang}|${targetLang}`;
                const response = await fetch(url);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();
                if (data.responseStatus !== 200) throw new Error(data.responseDetails || 'ë²ˆì—­ ì‹¤íŒ¨');
                return data.responseData.translatedText;
            } catch (error) {
                console.error('Translation error:', error);
                throw error;
            }
        }

        async function translateMarkdown(markdown, sourceLang = 'ko', targetLang = 'en') {
            try {
                if (!markdown || markdown.trim() === '') throw new Error('ë²ˆì—­í•  ë‚´ìš©ì´ ì—†ìŠµë‹ˆë‹¤.');
                
                // Split by paragraphs
                const paragraphs = markdown.split('\n\n').filter(p => p.trim());
                let translatedParagraphs = [];
                
                for (let i = 0; i < paragraphs.length; i++) {
                    const paragraph = paragraphs[i].trim();
                    if (paragraph) {
                        const translated = await translateText(paragraph, sourceLang, targetLang);
                        translatedParagraphs.push(translated);
                        if (i < paragraphs.length - 1) {
                            await new Promise(resolve => setTimeout(resolve, 100));
                        }
                    }
                }
                
                return translatedParagraphs.join('\n\n');
            } catch (error) {
                console.error('Markdown Translation error:', error);
                throw error;
            }
        }

        // Translation Buttons
        document.getElementById('translate-title-btn').addEventListener('click', async function() {
            const titleKor = document.getElementById('title-kor').value;
            const statusEl = document.getElementById('translate-title-status');
            if (!titleKor || titleKor.trim() === '') {
                alert('í•œêµ­ì–´ ì œëª©ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            this.disabled = true;
            statusEl.textContent = 'ë²ˆì—­ ì¤‘...';
            try {
                const translated = await translateText(titleKor);
                document.getElementById('title-en').value = translated;
                statusEl.textContent = 'âœ“ ë²ˆì—­ ì™„ë£Œ';
                setTimeout(() => statusEl.textContent = '', 3000);
            } catch (error) {
                statusEl.textContent = 'âœ— ë²ˆì—­ ì‹¤íŒ¨';
                alert('ë²ˆì—­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                this.disabled = false;
            }
        });

        document.getElementById('translate-desc-btn').addEventListener('click', async function() {
            const descKor = document.getElementById('desc-kor').value;
            const statusEl = document.getElementById('translate-desc-status');
            if (!descKor || descKor.trim() === '') {
                alert('í•œêµ­ì–´ ì„¤ëª…ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            this.disabled = true;
            statusEl.textContent = 'ë²ˆì—­ ì¤‘...';
            try {
                const translated = await translateText(descKor);
                document.getElementById('desc-en').value = translated;
                statusEl.textContent = 'âœ“ ë²ˆì—­ ì™„ë£Œ';
                setTimeout(() => statusEl.textContent = '', 3000);
            } catch (error) {
                statusEl.textContent = 'âœ— ë²ˆì—­ ì‹¤íŒ¨';
                alert('ë²ˆì—­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                this.disabled = false;
            }
        });

        document.getElementById('translate-content-btn').addEventListener('click', async function() {
            const contentKorMarkdown = editorKor.storage.markdown.getMarkdown();
            const statusEl = document.getElementById('translate-content-status');
            
            if (!contentKorMarkdown || contentKorMarkdown.trim() === '') {
                alert('í•œêµ­ì–´ ë³¸ë¬¸ì„ ë¨¼ì € ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            
            this.disabled = true;
            statusEl.textContent = 'ë²ˆì—­ ì¤‘... (ë³¸ë¬¸ì´ ê¸¸ë©´ ì‹œê°„ì´ ê±¸ë¦´ ìˆ˜ ìˆìŠµë‹ˆë‹¤)';
            
            try {
                const translatedMarkdown = await translateMarkdown(contentKorMarkdown);
                editorEn.commands.setContent(translatedMarkdown);
                statusEl.textContent = 'âœ“ ë³¸ë¬¸ ë²ˆì—­ ì™„ë£Œ';
                setTimeout(() => statusEl.textContent = '', 5000);
            } catch (error) {
                console.error('Translation error:', error);
                statusEl.textContent = 'âœ— ë²ˆì—­ ì‹¤íŒ¨';
                alert('ë²ˆì—­ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
            } finally {
                this.disabled = false;
            }
        });

        // Pinned Options Toggle
        document.getElementById('is-pinned').addEventListener('change', function() {
            const pinnedOptions = document.getElementById('pinned-options');
            pinnedOptions.style.display = this.checked ? 'block' : 'none';
        });

        function generateNextId(category) {
            const prefix = {
                'fashion': 'fs',
                'beauty': 'by',
                'life': 'lf',
                'districts': 'ds'
            }[category];

            const existingData = uploadedData[category] || [];
            
            if (existingData.length === 0) {
                return `${prefix}00001`;
            }

            const numbers = existingData
                .map(item => {
                    const match = item.id.match(/\d+$/);
                    return match ? parseInt(match[0]) : 0;
                })
                .filter(num => !isNaN(num));

            const maxNum = numbers.length > 0 ? Math.max(...numbers) : 0;
            const nextNum = maxNum + 1;

            return `${prefix}${String(nextNum).padStart(5, '0')}`;
        }

        // Publish Button Handler
        document.getElementById('publish-btn').addEventListener('click', async function() {
            const category = document.getElementById('category').value;
            const titleKor = document.getElementById('title-kor').value;
            const titleEn = document.getElementById('title-en').value;
            const descKor = document.getElementById('desc-kor').value;
            const descEn = document.getElementById('desc-en').value;
            const subcategory = document.getElementById('subcategory').value;
            const author = document.getElementById('author').value;

            // Validation
            if (!category) {
                alert('ì¹´í…Œê³ ë¦¬ë¥¼ ì„ íƒí•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!titleKor || !titleEn) {
                alert('ì œëª©(í•œêµ­ì–´, English)ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!descKor || !descEn) {
                alert('ì„¤ëª…(í•œêµ­ì–´, English)ì„ ëª¨ë‘ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!subcategory) {
                alert('ì¹´í…Œê³ ë¦¬ ì„¸ë¶€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!author) {
                alert('ì‘ì„±ìë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!thumbnailFile) {
                alert('ì¸ë„¤ì¼ ì´ë¯¸ì§€ë¥¼ ì—…ë¡œë“œí•´ì£¼ì„¸ìš”.');
                return;
            }

            let contentKor = editorKor.getHTML();
            let contentEn = editorEn.getHTML();

            if (!contentKor || contentKor === '<p></p>' || contentKor === '') {
                alert('í•œêµ­ì–´ ë³¸ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }
            if (!contentEn || contentEn === '<p></p>' || contentEn === '') {
                alert('ì˜ì–´ ë³¸ë¬¸ì„ ì‘ì„±í•´ì£¼ì„¸ìš”.');
                return;
            }

            // Disable button
            this.disabled = true;
            showUploadProgress(true);

            try {
                // Extract all base64 images from both editors
                const imagesKor = extractBase64Images(contentKor);
                const imagesEn = extractBase64Images(contentEn);
                const allImages = [...new Set([...imagesKor, ...imagesEn])]; // Remove duplicates
                
                updateUploadProgress(10, 'ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤€ë¹„ ì¤‘...', `ì´ ${allImages.length}ê°œì˜ ì´ë¯¸ì§€`);

                // Upload images to ImgBB and create mapping
                const imageMap = new Map();
                for (let i = 0; i < allImages.length; i++) {
                    const base64Image = allImages[i];
                    const percent = 10 + (80 * (i + 1) / allImages.length);
                    
                    updateUploadProgress(
                        percent,
                        `ì´ë¯¸ì§€ ì—…ë¡œë“œ ì¤‘... (${i + 1}/${allImages.length})`,
                        'ì ì‹œë§Œ ê¸°ë‹¤ë ¤ì£¼ì„¸ìš”...'
                    );

                    try {
                        const blob = base64ToBlob(base64Image);
                        const url = await uploadToImgBB(blob);
                        imageMap.set(base64Image, url);
                    } catch (error) {
                        console.error('Image upload failed:', error);
                        throw new Error(`ì´ë¯¸ì§€ ì—…ë¡œë“œ ì‹¤íŒ¨: ${i + 1}ë²ˆì§¸ ì´ë¯¸ì§€`);
                    }
                }

                // Replace base64 with URLs in both contents
                contentKor = replaceBase64WithUrls(contentKor, imageMap);
                contentEn = replaceBase64WithUrls(contentEn, imageMap);

                updateUploadProgress(90, 'ZIP íŒŒì¼ ìƒì„± ì¤‘...', 'ê±°ì˜ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤...');

                // Generate next ID
                const newId = generateNextId(category);
                const imagePath = `img/${category}/${newId}.jpg`;

                const culturalBadge = document.getElementById('cultural-badge').value || null;
                const tagsInput = document.getElementById('tags').value;
                const tags = tagsInput ? tagsInput.split(',').map(t => t.trim()) : [];
                const districtId = document.getElementById('district-select').value || null;
                const today = new Date().toISOString().split('T')[0];

                const categoryEntry = {
                    id: newId,
                    district_id: districtId,
                    title_kor: titleKor,
                    title_en: titleEn,
                    desc_kor: descKor,
                    desc_en: descEn,
                    category: subcategory,
                    image: imagePath,
                    tags: tags,
                    cultural_badge: culturalBadge,
                    date: today,
                    author: author,
                    views: 0
                };

                const articleEntry = {
                    id: newId,
                    article_html_ko: contentKor,
                    article_html_en: contentEn
                };

                // Create ZIP file
                const zip = new JSZip();

                // Add category JSON
                const categoryData = [...uploadedData[category], categoryEntry];
                zip.file(`${category}.json`, JSON.stringify(categoryData, null, 2));

                // Add article JSON
                const articleData = [...uploadedData.article, articleEntry];
                zip.file(`article.json`, JSON.stringify(articleData, null, 2));

                // Add pinned JSON if needed
                const isPinned = document.getElementById('is-pinned').checked;
                if (isPinned) {
                    let pinnedData = { ...uploadedData.pinned };
                    const pinnedTypes = [];
                    if (document.getElementById('pinned-hero').checked) pinnedTypes.push('hero');
                    if (document.getElementById('pinned-todayStories').checked) pinnedTypes.push('todayStories');
                    if (document.getElementById('pinned-mustRead').checked) pinnedTypes.push('mustRead');

                    pinnedTypes.forEach(type => {
                        if (!pinnedData[type]) pinnedData[type] = [];
                        pinnedData[type].push({ source: category, id: newId });
                    });

                    zip.file(`pinned.json`, JSON.stringify(pinnedData, null, 2));
                }

                // Add thumbnail image
                zip.file(`${newId}.jpg`, thumbnailFile);

                // Generate ZIP
                const content = await zip.generateAsync({ type: 'blob' });
                
                // Download ZIP
                const url = URL.createObjectURL(content);
                const a = document.createElement('a');
                a.href = url;
                a.download = `fbc_content_${newId}.zip`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);

                updateUploadProgress(100, 'ì™„ë£Œ!', 'íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.');
                
                setTimeout(() => {
                    showUploadProgress(false);
                    alert(`ë°œí–‰ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!\n\nID: ${newId}\nì´ë¯¸ì§€ ê²½ë¡œ: ${imagePath}\n\n${allImages.length}ê°œì˜ ì´ë¯¸ì§€ê°€ ì—…ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.\nZIP íŒŒì¼ì´ ë‹¤ìš´ë¡œë“œë˜ì—ˆìŠµë‹ˆë‹¤.`);
                }, 1000);

            } catch (error) {
                console.error('Publish error:', error);
                showUploadProgress(false);
                alert(`ë°œí–‰ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤:\n${error.message}`);
            } finally {
                this.disabled = false;
            }
        });

        document.getElementById('newsletter-submit').addEventListener('click', () => {
            const email = document.getElementById('newsletter-email').value;
            if (email) {
                alert('ë‰´ìŠ¤ë ˆí„° ì‹ ì²­ì´ ì™„ë£Œë˜ì—ˆìŠµë‹ˆë‹¤!');
                document.getElementById('newsletter-email').value = '';
            }
        });
    </script>

</body>
</html>
